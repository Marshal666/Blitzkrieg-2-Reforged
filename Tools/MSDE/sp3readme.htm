<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Service Pack 3 for Microsoft SQL Server 2000</TITLE>

<!-- Document last modified on  Monday, December 09, 2002 - 1:16 PM -->

<Style TYPE="text/css">
<!--

/* Style sheet optimized for IE4x - Last updated 2/9/99 */
/* changed h1-h4 font sizes */

body    		{ color: #000000;
		background: #FFFFFF;  	
		font-size: 70%;    		
		font-family: Verdana, Arial, Helvetica, Sans Serif }

a:link	 	{ color: "#0000FF"; text-decoration:"underline";}

a:visited 	{ color: "#660000"; text-decoration:"underline";}

a:active, a:hover 	{ color: "#FF0000";  cursor:hand; text-decoration:"underline";}

h1
		{ font-size: 190%; 
		margin-bottom:" .5em"; clear:both; }

h2
		{ font-size: 175%;  
		margin-top: 1.5em;
		margin-bottom:" .5em"; clear:both; }

h3
		{ font-size: 160%; 
		margin-top: 1.2em;  
		margin-bottom: ".5em"; clear:both; }

h4
		{ font-size: 145%; 
		margin-bottom:" .5em"; clear:both; }

h5
		{ font-size: 115%;  
		margin-top: 1.5em;
		margin-bottom:" .5em"; clear:both; }

h6
		{ font-size: 110%; 
		margin-top: 1.2em;  
		margin-bottom: ".5em"; clear:both; }

p
		{ margin-top:" .6em"; 
		margin-bottom: ".6em"; }
			
ol
		{ margin-top: ".5em"; 
		margin-bottom: 0; 
		margin-left: "2.1em"; 
		padding-left: "0em"; }
	
ul
		{ margin-top: ".6em"; 	
		margin-bottom: 0;
		list-style-type: disc;
		margin-left: "1.5em";
		padding-left: "0em"; }
		
li
		{ margin-bottom: ".7em"; clear:both; }

dd
		{ margin-bottom: 0; 
		margin-left: "1.5em"; }

em
		{ color: "#FF0000"; } 

/* for defined terms, follow the "Document Conventions" listing in the Microsoft Manual of Style: */
/* Keywords, functions, and anything else the user must enter exactly as shown are bold--add "font-weight: bold;" to the dt tag */
/* Variables, book titles, and placeholders the user must provide are italic--add "font-style: italic;" to the dt tag */
/* pre-defined arguments are bold and italic--add "font-weight: bold;" and "font-style: italic;" to the dt tag */

dt
		{ margin-top: "2em"; }

pre
		{ margin-top: "1.2em";
		margin-bottom: "1.5em"; }

code
		{ font-family: Courier New; 
		font-size: 125% }

table
		{ font-size: 100%;
		margin-top: "1em"; 
		margin-bottom: "1em"; 
		cellpadding: "0.5em"; }
		
th
		{ text-align: left;
		background: #DDDDDD;
		vertical-align: bottom;}
		
tr
		{ vertical-align: top; }

td
		{ background: #EEEEEE;
		vertical-align: top; }

/* Alert text ID formats */

#Alert_Note        { color: "#000000"; margin-left:" 1.5em"; margin-top:" 1em"; margin-bottom:"1em" }

#Alert_Important { color: "#8B0000"; margin-left:" 1.5em"; margin-top:" 1em"; margin-bottom:"1em"  }

#Alert_Warning  { color: "B22222"; margin-left:" 1.5em"; margin-top:" 1em"; margin-bottom:"1em"  }
		  
// -->
</style>
</HEAD>
<BODY>

<H1>Service Pack 3 for Microsoft SQL Server 2000</H1>

<H5>December 9, 2002</H5>

<P>&copy; Copyright Microsoft Corporation, 2002. All rights reserved.</P>
<P style="background-color: #C0FFFF">&nbsp;<BR>The SQL Server documentation team cannot answer technical support questions, but welcomes your suggestions and comments about this readme documentation. You can quickly and directly send e-mail feedback using the link below. All feedback must be in English.<BR><BR>To submit written feedback about this document, click here:&nbsp;&nbsp;<A HREF="mailto:sqldocfb@microsoft.com?subject=SQL Server Service Pack 3 readme file&body=---Please type comments here, leaving the subject line in place.---">Submit feedback</A>.<BR>&nbsp;</P>

<H1><A NAME="_contents_ar5q"></A>Contents</H1>

<P>1.0 <A HREF="#_introduction">Introduction</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;1.1 <A HREF="#_details_of_database_components_sp3_installation">Overview of Database Components SP3 Installation</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;1.2 <A HREF="#_removing_sp3">Removing SP3</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;1.3 <A HREF="#_identifying_the_current_version_of_sql_server_or_analysis_services">Identifying the Current Version of SQL Server or Analysis Services</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;1.4 <A HREF="#_additional_information_about_sp3">Additional Information About SP3</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;1.5 <A HREF="#_updated_books_online_documentation_is_av_wluf">Updated Books Online Documentation Is Available</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;1.6 <A HREF="#_updated_sql_server_and_analysis_services_d3jb">Updated SQL Server and Analysis Services Samples Are Available</A></P>

<P>2.0 <A HREF="#_downloading_and_extracting_sp3">Downloading and Extracting SP3</A></P>

<P>3.0 <A HREF="#_service_pack_installation">Service Pack Installation</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.1 <A HREF="#_back_up_your_sql_server_databases">Back Up Your SQL Server Databases</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.2 <A HREF="#_back_up_your_analysis_services_databases">Back Up Your Analysis Services Databases and Repository</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.3 <A HREF="#_make_sure_that_the_system_databases_have_enough_free_space">Make Sure the System Databases Have Enough Free Space</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.4 <A HREF="#_stop_services_and_applications_before_running_sp3_setup">Stop Services and Applications Before Running SP3 Setup</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.5 <A HREF="#_install_database_components_sp3">Install Database Components SP3</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.6 <A HREF="#_install_analysis_services_sp3">Install Analysis Services SP3</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.7 <A HREF="#_install_desktop_engine_sp3">Install Desktop Engine SP3</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.8 <A HREF="#_restart_services">Restart Services</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.9 <A HREF="#_restart_applications">Restart Applications</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.10 <A HREF="#_installing_on_a_failover_cluster">Installing on a Failover Cluster</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.11 <A HREF="#_installing_on_replicated_servers">Installing on Replicated Servers</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.12 <A HREF="#_applying_sp3_to_read-only_databases_or_filegroups">Applying SP3 to Read-Only Databases or Filegroups</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.13 <A HREF="#_uninstalling_sp3">Uninstalling SP3</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;3.14 <A HREF="#_reapplying_sp3">Reapplying SP3</A></P>

<P>4.0 <A HREF="#_additional_installation_considerations">Additional Installation Considerations</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;4.1 <A HREF="#_unattended_installations">Unattended Installations</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;4.2 <A HREF="#_redistributing_database_components_sp3_client_components">Redistributing SP3 Data Access Components</A></P>

<P>5.0 <A HREF="#_documentation_notes">Documentation Notes</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.1 <A HREF="#_database_and_desktop_engine_enhancements">Database and Desktop Engine Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.1 <A HREF="#_using_chinese_japanese_or_korean_characters_with_database_components sp3">Using Chinese, Japanese, or Korean Characters with Database Components SP3</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.2 <A HREF="#_hash_teams_removed">Hash Teams Removed</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.3 <A HREF="#_affinity_mask_switches_added">Affinity Mask Switches Added</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.4 <A HREF="#_filtered_indexed_view">Filtered Indexed View</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.5 <A HREF="#_full-text_catalogs_will_be_rebuilt_after_setup_completes">Full-Text Catalogs Are Rebuilt After Setup Completes</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.6 <A HREF="#_syntax_changes_for_sp_change_users_login_wluf">Syntax Changes for sp_change_users_login</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.7 <A HREF="#_ad_hoc_access_to_ole_db_providers_disabl_fzpy">Ad Hoc Access to OLE DB Providers Disabled by Default</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.8 <A HREF="#_new_sqlserverlike_provider_option_cuy1">New SqlServerLike Provider Option</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.9 <A HREF="#_expanded_error_messages_for_distributed__d3jb">Expanded Error Messages for Distributed Queries</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.10 <A HREF="#_new_function_fn_get_sql_returns_sql_stat_wluf">New Function fn_get_sql Returns SQL Statement</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.11 <A HREF="#_enabling_cross45database_ownership_chain_ar5q">Cross-Database Ownership Chaining</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.12 <A HREF="#_enhancements_for_trace_flag_1204_gq59">Enhancement for Trace Flag 1204</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.13 <A HREF="#_permissions_change_for_sp_changedbowner_2y0t">Permissions Change for sp_changedbowner</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.14 <A HREF="#_debugging_functionality_changes_f8s1">Debugging Functionality Changes</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.2 <A HREF="#_analysis_services_enhancements">Analysis Services Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.1 <A HREF="#_remote_partitions">Remote Partitions</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.2 <A HREF="#_updated_analysis_services_redistributable_client_setup">Updated Analysis Services Redistributable Client Setup</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.3 <A HREF="#_support_enabled_for_third_party_data_mining_algorithm_providers">Support Enabled for Third-Party Data Mining Algorithm Providers</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.4 <A HREF="#_installing_analysis_services_on_a_computer_with_updated_client_files">Installing Analysis Services on a Computer with Updated Client Files</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.5 <A HREF="#_increased_limit_for_olap_cubes_reference_wluf">Increased Limit for OLAP Cubes Referenced by a Virtual Cube</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.6 <A HREF="#_new_description_keyword_fzpy">New DESCRIPTION Keyword</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.7 <A HREF="#_new_pivot_table_service_restricted_clien_cuy1">New PivotTable Service Restricted Client Property</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.8 <A HREF="#_change_to_the_safety_options_property_0a8g">Change in the Safety Options Property</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.9 <A HREF="#_migrate_repository_to_meta_data_services_d3jb">Migrate Repository to Meta Data Services Disabled by Default</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.10 <A HREF="#_permissions_must_be_modified_on_a_remote_d3jb">Permissions Must be Modified on a Remote Data Folder</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.3 <A HREF="#_replication_enhancements">Replication Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.1 <A HREF="#_transactional_replication_update_custom_stored_procedure">Transactional Replication UPDATE Custom Stored Procedure</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.2 <A HREF="#_transactional_replication_update_statements_on_unique_columns">Transactional Replication UPDATE Statements on Unique Columns</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.3 <A HREF="#_restrictions_removed_from_concurrent_snapshot_processing">Restrictions Removed from Concurrent Snapshot Processing</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.4 <A HREF="#_transactional_replication_scripting_custom_stored_procedures">Transactional Replication Scripting Custom Stored Procedures</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.5 <A HREF="#_merge_replication_retention-based_meta_data_clean_up">Merge Replication Retention-Based Meta Data Clean Up</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.6 <A HREF="#_backup_and_restore_issues_for_merge_replication">Backup and Restore Issues for Merge Replication</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.7 <A HREF="#_restoring_replicated_databases_from_different_versions_of_sql_server">Restoring Replicated Databases from Different Versions of SQL Server</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.8 <A HREF="#_a_new_-maxcmdsintran_parameter_for_log_reader_agent">New -MaxCmdsInTran Parameter for Log Reader Agent</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.9 <A HREF="#_restriction_on_non-unique_clustered_indexes">Restriction on Non-unique Clustered Indexes</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.10 <A HREF="#_a_new_-maxnetworkoptimization_command_line_argument_for_snapshot_agent">New &#0150;MaxNetworkOptimization Command Line Argument for Snapshot Agent</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.11 <A HREF="#_merge_replication_uses_new_role_d3jb">Merge Replication Uses New Role</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.12 <A HREF="#_sql_agent_proxy_account_required_for_non_wluf">New Requirements for Subscriptions Created by Non-sysadmin Users</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.13 <A HREF="#_changes_to_permissions_on_stored_procedu_d3jb">Changes to Permissions for Stored Procedures</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.14 <A HREF="#_new_parameter_for_sp_addmergearticle_and_fzpy">New Parameter for sp_addmergearticle and sp_changemergearticle</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.15 <A HREF="#_new_page_for_configure_publishing_and_di_fzpy">New Page for Configure Publishing and Distribution Wizard</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.16 <A HREF="#_changes_to_windows_synchronization_manag_d3jb">Changes to Windows Synchronization Manager Support</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.3.17 <A HREF="#_change_to_requirements_for_attaching_40o_wluf">Change to Requirements for Attaching or Restoring a Replication Database</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.4 <A HREF="#_5464_sql_server_agent_enhancements_705">SQL Server Agent Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.4.1 <A HREF="#_sql_server_agent_logs_account_information">SQL Server Agent Logs Account Information</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.4.2 <A HREF="#_5464461_changes_to_master47target_server_533">Changes to Master/Target Server Configurations</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.4.3 <A HREF="#_5464462_new_sql_server_agent_extended_st_579">New SQL Server Agent Extended Stored Procedure</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.4.4 <A HREF="#_sql_server_agent_permission_checks_d3jb">SQL Server Agent Permission Checks</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.5 <A HREF="#_sql_server_connectivity_components_aks2">SQL Server Connectivity Component Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.5.1 <A HREF="#_microsoft_data_access_components_9s7l">Updates to Microsoft Data Access Components</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.5.2 <A HREF="#_support_for_qlogic_virtual_interface_arc_wrr2">Support for QLogic Virtual Interface Architecture</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.6 <A HREF="#_meta_data_services">Meta Data Services Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.6.1 <A HREF="#_meta_data_browser_exports_in_unicode">Meta Data Browser Exports in Unicode</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.6.2 <A HREF="#_scripting_support_disabled_fzpy">Scripting Support Disabled</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.6.3 <A HREF="#_new_repositoryuser_role_needed_to_access_d3jb">New RepositoryUser Role for Accessing Repository Information</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.7 <A HREF="#_data_transformation_services">Data Transformation Services Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.7.1 <A HREF="#_dts_wizard_no_longer_limits_string_columns_to_255_characters">DTS Wizard No Longer Limits String Columns to 255 Characters</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.7.2 <A HREF="#_security_context_logged_for_dts_packages_run_by_sql_server_agent">Security Context Logged for DTS Packages Run by SQL Server Agent</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.7.3 <A HREF="#_sql_server_agent_proxy_account_improvements">SQL Server Agent Proxy Account Improvements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.7.4 <A HREF="#_save_to_repository_disabled_by_default_d3jb">Save to Meta Data Services Disabled by Default</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.8 <A HREF="#_sqlxml_enhancement_d3jb">XML Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.8.1 <A HREF="#_improved_validation_of_xpath_expressions_wluf">Improved Validation of XPath Expressions</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.9 <A HREF="#_enhancements_to_the_virtual_backup_device_api">Virtual Backup Device API Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.9.1 <A HREF="#_capturing_multiple_databases_in_a_single_snapshot">Capturing Multiple Databases in a Single Snapshot</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.10 <A HREF="#_5467_error_reporting_705">Error Reporting</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.11 <A HREF="#_english_query_enhancement">English Query Enhancements</A></P>

<P>&nbsp;&nbsp;&nbsp;&nbsp;5.12 <A HREF="#_db-library_and_embedded_sql_for_c">DB-Library and Embedded SQL for C</A></P>

<H1><A NAME="_introduction"></A>1.0 Introduction</H1>

<P>This release of Service Pack 3 (SP3) for Microsoft&reg; SQL Server&trade; 2000 is provided in three parts:

<UL type=disc>
	<LI>Database Components SP3 provides updates for the database components of an instance of SQL Server 2000, excluding instances of the SQL Server 2000 Desktop Engine. Database Components SP3 includes updates to:
<UL type=disc>
	<LI>The database engine.<BR><BR></LI>

	<LI>Database client tools and utilities such as SQL Server Enterprise Manager and the <B>osql</B> utility.<BR><BR></LI>

	<LI>Database client connectivity components, such as the Microsoft OLE DB Provider for SQL Server 2000, the SQL Server 2000 ODBC driver, and the client Net-Libraries.</LI>
</UL>
</LI>

	<LI>Analysis Services SP3 provides updates for the SQL Server 2000 Analysis Services components of a SQL Server 2000 installation, including:
<UL type=disc>
	<LI>Analysis Services.<BR><BR></LI>

	<LI>Analysis Services client components, which include Analysis Manager and the Microsoft OLE DB Provider for Analysis Services.<BR><BR></LI>

	<LI>Database client connectivity components, such as the Microsoft OLE DB Provider for SQL Server 2000, the SQL Server 2000 ODBC driver, and the client Net-Libraries.</LI>
</UL>
</LI>

	<LI>Desktop Engine SP3 provides updates for the database components of an instance of SQL Server 2000 Desktop Engine (also referred to as MSDE 2000), including:
<UL type=disc>
	<LI>The database engine.<BR><BR></LI>

	<LI>Database client connectivity components, such as the Microsoft OLE DB Provider for SQL Server 2000, the SQL Server 2000 ODBC driver, and the client Net-Libraries.</LI>
</UL>
</LI>
</UL>

<P>These three parts of SP3 can be applied individually, as follows:

<UL type=disc>
	<LI>SQL Server 2000 sites can use Database Components SP3 to upgrade their database components without upgrading their Analysis Services components or instances of the SQL Server 2000 Desktop Engine.<BR><BR></LI>

	<LI>Analysis Services 2000 sites can use Analysis Services SP3 to upgrade their Analysis Services components without upgrading instances of Desktop Engine or their database components.<BR><BR></LI>

	<LI>Desktop Engine sites can use Desktop Engine SP3 to upgrade instances of Desktop Engine without upgrading Analysis Services or instances of other editions of SQL Server 2000. 
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If separate instances of both Desktop Engine and other editions of SQL Server 2000 are installed on the same computer, you must apply Desktop Engine SP3 to instances of Desktop Engine and Database Components SP3 to the other instances of SQL Server 2000.</p></P><!--/NOTE--></LI>
</UL>

<P>For more information about installing Desktop Engine, see Section 3.7 <A HREF="#_install_desktop_engine_sp3">Install Desktop Engine SP3</A>.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Desktop Engine SP3 is the only part of the service pack that is available in Portuguese (Brazil), Swedish, and Dutch, because SQL Server 2000 Desktop Engine is the only version of SQL Server 2000 that is produced for those languages. The SQL Server 2000 components upgraded by Database Components SP3 or Analysis Services SP3 are not available in those languages. Portuguese (Brazil), Swedish, and Dutch users who want to apply SP3 to a version of SQL Server other than Desktop Engine must download the SP3 files that match the language of the edition they want to upgrade. For example, English-language SP3 files must be downloaded to upgrade the English-language version of SQL Server 2000. For information about how to download the service pack, see Section 2.0 <A HREF="#_downloading_and_extracting_sp3">Downloading and Extracting SP3</A>.</P>
</P><!--/NOTE-->
<H2><A NAME="_details_of_database_components_sp3_installation"></A>1.1 Overview of Database Components SP3 Installation</H2>

<P>The Database Components SP3 Setup program automatically detects which edition of SQL Server 2000 is present on the instance of SQL Server 2000 being upgraded. Setup upgrades only the components that are installed for that instance. For example, if you apply the service pack to a computer running SQL Server 2000 Standard Edition, the service pack does not attempt to upgrade components that are included only with SQL Server 2000 Enterprise Edition.</P>

<P>You can apply Database Components SP3 to a single default instance or a named instance of SQL Server. If you are upgrading multiple instances of SQL Server 2000 to SP3, you must apply SP3 to each instance. When one instance on a computer with one or more instances of SQL Server 2000 is upgraded to SP3, all of the tools are upgraded to SP3. There are not separate copies of the tools for each instance. </P>

<H2><A NAME="_removing_sp3"></A>1.2 Removing SP3</H2>

<P>The way in which you remove SQL Server SP3 depends on the SQL Server 2000 SP3 components that you are removing.</P>

<H5>Removing SQL Server Database Components and Desktop Engine SP3 </H5>

<P>When SQL Server Database Components SP3 is installed, it makes changes to the system tables for maintenance reasons, and it also upgrades user and distribution databases that are members of a replication topology. Because of these changes, SP3 cannot be removed easily. To revert to the build that you were running before installing SP3, first, you must uninstall the instance of SQL Server 2000; then, you must reinstall that instance. If you were running a previous SQL Server 2000 service pack or applied any Quick Fix Engineering (QFE) fixes, you must reapply that service pack and any QFE fixes to the instance. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;To remove SP3, you must have backups of the <B>master</B>, <B>model</B>, and <B>msdb</B> databases, which were taken immediately prior to applying SP3. For more information, see Section 3.1 <A HREF="#_back_up_your_sql_server_databases">Back Up Your SQL Server Databases</A> and Section 3.2 <A HREF="#_back_up_your_analysis_services_databases">Back Up Your Analysis Services Databases and Repository</A>. </P><!--/NOTE--></P>

<P>For more information, see <A HREF="#_uninstalling_sql_server_2000_components__d3jb">Uninstalling SQL Server 2000 Components and Desktop Engine SP3</A>.</P>

<H5>Removing SQL Server Analysis Services Components SP3 </H5>

<P>To be able to return SQL Server Analysis Services to its pre-SP3 state, you must back up the registry key <B>HK_LOCAL_MACHINE\Software\Microsoft\OLAP Server</B> and all of its sub-keys before installing SP3. When uninstalling SP3, you must delete this registry key and restore the pre-SP3 version from the backup.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Updates to MDAC 2.7 SP1 that are made during SP3 setup cannot be uninstalled.</P><!--/NOTE--></P>

<P>For more information, see <A HREF="#_uninstalling_sql_server_2000_analysis_se_wluf">Uninstalling SQL Server 2000 Analysis Services SP3</A>.</P>

<H2><A NAME="_identifying_the_current_version_of_sql_server_or_analysis_services"></A>1.3 Identifying the Current Version of SQL Server or Analysis Services</H2>

<P>Use the techniques in the following sections to determine which version of SQL Server or Analysis Services you have installed.</P>

<H5>SQL Server</H5>

<P>To identify which version of SQL Server 2000 you have installed, type <CODE>SELECT @@VERSION</CODE> or <CODE>SERVERPROPERTY('ProductVersion')</CODE> at the command prompt using the <B>osql</B> or <B>isql</B> utility or in the <B>Query</B> window in SQL Query Analyzer. </P>

<P>Similarly, the product level for a given version of SQL Server 2000 can be determined by executing <CODE>SELECT SERVERPROPERTY('ProductLevel')</CODE>. </P>

<P>The following table shows the relationship between the SQL Server 2000 version and level and the version number reported by <CODE>@@VERSION </CODE>and the product level reported by <CODE>SERVERPROPERTY('ProductLevel')</CODE>.</P>

<TABLE border=1 cellpadding=2 cols=3 frame=box rules=rows width=584>

<TR VALIGN="top">
<TD width=46%><B>SQL Server 2000 version and level</B></TD>
<TD width=30%><B>@@VERSION</B></TD>
<TD width=24%><B>ProductLevel</B></TD>
</TR>

<TR VALIGN="top">
<TD width=46%>SQL Server 2000 RTM</TD>
<TD width=30%>8.00.194</TD>
<TD width=24%>RTM</TD>
</TR>

<TR VALIGN="top">
<TD width=46%>Database Components SP1</TD>
<TD width=30%>8.00.384</TD>
<TD width=24%>SP1</TD>
</TR>

<TR VALIGN="top">
<TD width=46%>Database Components SP2</TD>
<TD width=30%>8.00.534</TD>
<TD width=24%>SP2</TD>
</TR>

<TR VALIGN="top">
<TD width=46%>Database Components SP3 </TD>
<TD width=30%>8.00.760</TD>
<TD width=24%>SP3</TD>
</TR>
</TABLE><BR>

<P>If you are not sure which edition of SQL Server 2000 you are running, view the last line of output returned by <CODE>SELECT @@VERSION</CODE>. The last line should match one of the following: </P>

<PRE><CODE>Desktop Engine on Windows NT 5.0 (Build 2195: Service Pack 2)
Enterprise Evaluation Edition on Windows NT 5.0 (Build 2195: Service Pack 2)
Developer Edition on Windows NT 5.0 (Build 2195: Service Pack 2)
Personal Edition on Windows NT 5.0 (Build 2195: Service Pack 2)
Standard Edition on Windows NT 5.0 (Build 2195: Service Pack 2)
Enterprise Edition on Windows NT 5.0 (Build 2195: Service Pack 2)</CODE></PRE>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;The beginning of the line indicates the edition of SQL Server. This is followed by current operating system information.</P><!--/NOTE--></P>

<P>You can also determine the edition by typing <CODE>SELECT SERVERPROPERTY('Edition')</CODE> at the command prompt using the <B>osql</B> or <B>isql</B> utility or in the <B>Query</B> window in SQL Query Analyzer. </P>

<H5>Analysis Services</H5>

<P>To identify which version of Analysis Services you have installed, follow these steps:

<OL>
	<LI>From the <B>Start</B> menu, point to <B>Program Files</B>, point to <B>SQL Server 2000</B>, point to <B>Analysis Services</B>, and then click <B>Analysis Manager</B>.<BR><BR></LI>

	<LI>In the Analysis Manager tree, right-click the Analysis Servers node, and then click <B>About Analysis Services</B>.<BR><BR></LI>

	<LI>Use the following table to determine which version of Analysis Services you have.</LI>
</OL>

<TABLE border=1 cellpadding=2 cols=2 frame=box rules=rows width=568>

<TR VALIGN="top">
<TD width=54%><B>Analysis Services version</B></TD>
<TD width=46%><B>Build Number in Help About</B></TD>
</TR>

<TR VALIGN="top">
<TD width=54%>SQL Server 2000 Analysis Services RTM</TD>
<TD width=46%>8.0.194</TD>
</TR>

<TR VALIGN="top">
<TD width=54%>Analysis Services SP1</TD>
<TD width=46%>8.0.382</TD>
</TR>

<TR VALIGN="top">
<TD width=54%>Analysis Services SP2</TD>
<TD width=46%>8.0.534</TD>
</TR>

<TR VALIGN="top">
<TD width=54%>Analysis Services SP3</TD>
<TD width=46%>8.0.760</TD>
</TR>
</TABLE><BR>

<H2><A NAME="_additional_information_about_sp3"></A>1.4 Additional Information about SP3</H2>

<P>A list of the fixes contained in this service pack will be provided in Microsoft Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=8632" target=_blank>306908</A>. Each fix listed in <A HREF="http://go.microsoft.com/fwlink/?LinkId=8632" target=_blank>306908</A> has a link to a Knowledge Base article describing the problem addressed by the fix. Follow the links to the individual Knowledge Base articles to see information about each fix. These articles are published at the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>.</P>

<P class=label><B>To find an article in the Knowledge Base</B>

<OL>
	<LI>From the <B>Select a Microsoft Product</B> list, select <B>SQL Server 2000</B>.<BR><BR></LI>

	<LI>In the <B>Search for...</B> field, type the number of the article you want.<BR><BR></LI>

	<LI>Under <B>Search Type</B>, select <B>Article ID</B>.<BR><BR></LI>

	<LI>Click the <B>Go</B> button. </LI>
</OL>

<P>Any information relevant to SQL Server 2000 Service Pack 3 that was not available in time to be included in this readme file will be published in Microsoft Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=10753" target=_blank>330022</A>. This article is available at the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>.</P>

<H4>Microsoft Data Access Components</H4>

<P>This service pack includes updates to the Microsoft Data Access Components (MDAC), including updates for MSXML. </P>

<P>For more information, see Section 5.5.1 <A HREF="#_microsoft_data_access_components_9s7l">Updates to Microsoft Data Access Components</A>.</P>

<H4>QFE Fixes</H4>

<P>All publicly issued SQL Server 2000 SP2 security bulletins have been addressed in SP3.</P>

<P>If you received a SQL Server 2000 hotfix after October 14, 2002, that hotfix is not likely to be included in SP3. Contact your primary support provider about obtaining the same hotfix for SQL Server 2000 SP3.</P>

<H4>SQL Server CE Server Tools Updates</H4>

<P>Users of Microsoft SQL Server 2000 Windows&reg; CE Edition (SQL Server CE) who have upgraded or plan to upgrade SQL Server 2000 database and publisher servers to SP3 should also update the server replication components on Microsoft Internet Information Services (IIS) servers. An updated SQL Server CE Server Tools installer is available at this <A HREF="http://go.microsoft.com/fwlink/?LinkId=11696" target=_blank>Microsoft Web site</A>.</P>

<H2><A NAME="_updated_books_online_documentation_is_av_wluf"></A>1.5 Updated Books Online Documentation Is Available</H2>

<P>Updated documentation for SP3 is available. SQL Server 2000 Books Online (Updated - SP3) contains minor revisions plus new information that is related to SP3.</P>

<P>You can download SQL Server 2000 Books Online (Updated - SP3) from this <A HREF="http://go.microsoft.com/fwlink/?LinkId=9506" target=_blank>Microsoft Web site</A>.</P>

<H2><A NAME="_updated_sql_server_and_analysis_services_d3jb"></A>1.6 Updated SQL Server and Analysis Services Samples Are Available</H2>

<P>SQL Server 2000 and Analysis Services samples that have been updated for SP3 are available. You can download these updated samples from this <A HREF="http://go.microsoft.com/fwlink/?LinkId=11615" target=_blank>Microsoft Web site</A>.</P>

<H1><A NAME="_downloading_and_extracting_sp3"></A>2.0 Downloading and Extracting SP3</H1>

<P>SP3 is distributed in the following ways:

<UL type=disc>
	<LI>On a SQL Server 2000 Service Pack 3 CD-ROM that contains service packs for the following components:
<UL type=disc>
	<LI>Database Components SP3<BR><BR></LI>

	<LI>Analysis Services SP3<BR><BR></LI>

	<LI>Desktop Engine SP3</LI>
</UL>
</LI>

	<LI>In three self-extracting files that can be downloaded from the Internet at the <A HREF="http://go.microsoft.com/fwlink/?LinkId=4172" target=_blank>Microsoft SQL Server Downloads Web site</A>:
<UL type=disc>
	<LI>Sql2ksp3.exe (Database Components SP3)<BR><BR></LI>

	<LI>Sql2kasp3.exe (Analysis Services SP3)<BR><BR></LI>

	<LI>Sql2kdesksp3.exe (Desktop Engine SP3)</LI>
</UL>
</LI>
</UL>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Both the SQL Server 2000 Service Pack 3 CD-ROM and Sql2kdesksp3.exe contain the merge modules and .msi files that are required to install a new instance of Desktop Engine. </P><!--/NOTE--></P>

<H5><A NAME="_database_and_analysis_services_sp3_files"></A>Database Components and Analysis Services SP3 Files</H5>

<P>When downloading and extracting Database Components or Analysis Services SP3 installation files from the Internet, use the following guidelines: 

<UL type=disc>
	<LI>Download one of the files listed in Section 2.0 and place the self-extracting file either in a folder on the computer that is running the instance of SQL Server 2000 on which you are installing the service pack or in a folder on a network share. From that folder, run the file. The self-extraction program prompts you for the name of the folder into which you want the service pack files placed. 
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;When you extract the service pack to a network share, the path to the folder that you specify is relative to the folder in which you ran the self-extraction program.</P><!--/NOTE--></p></LI>

	<LI>On the local drive or network share to which you download the service pack installation files, you must have free space approximately that is three times the size of the self-extracting file. This includes space to store the self-extracting file, space for storing the extracted service pack files, and temporary working space required by the self-extraction program itself. <BR><BR></LI>

	<LI>You can rename or move the folder after extracting the components; however, make sure that the directory path name does not contain blank spaces. You can use the same target folder for each of the self-extracting files; they will not overwrite each other or interfere with each other.<BR><BR></LI>

	<LI>The self-extracting files are used to build a set of directories and files that are the same as those on the SP3 CD-ROM. If you download SP3 you must extract the files to build the service pack directories before you can run SQL Server Setup.<BR><BR></LI>

	<LI>For Database Components SP3 and Analysis Services SP3, the setup process is the same for both the CD-ROM and the extracted files.</LI>
</UL>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Some of the files in the service packs are system files. You cannot view them unless you follow this procedure: In Windows Explorer, on the <B>View</B> menu, click <B>Options</B>, click the <B>View</B> tab, and then select the <B>Show all files</B> check box.</P><!--/NOTE--></P>

<P>Database Components and Analysis Services installation files both contain updated setup documentation that you can access by clicking <B>Help</B> during SP3 setup. This documentation does not update the version of SQL Server 2000 Books Online that is already installed on your computer. For information about how to get an updated version of SQL Server Books Online, see Section 1.5 <A HREF="#_updated_books_online_documentation_is_av_wluf">Updated Books Online Documentation Is Available</A>. If you want to access just the updated SQL Server 2000 SP3 setup documentation without updating SQL Server Books Online, run the Setupsql.chm file. Setupsql.chm is located in the \Books subfolder of the directory on the SP3 CD-ROM, the local directory, or the network share that contains the extracted service pack files.</P>

<H5><A NAME="_desktop_engine_sp3_file"></A>Desktop Engine SP3 File</H5>

<P>For information on downloading and extracting Desktop Engine SP3, see Section 3.7 <A HREF="#_install_desktop_engine_sp3">Install Desktop Engine SP3</A>.</P>

<H1><A NAME="_service_pack_installation"></A>3.0 Service Pack Installation</H1>

<P>To install SP3, use the installation instructions in the following sections. Not all steps are required, depending on which of the following SQL Server 2000 components or configurations you are applying the service pack to:

<UL type=disc>
	<LI>Database Components<BR><BR></LI>

	<LI>Analysis Services<BR><BR></LI>

	<LI>Desktop Engine<BR><BR></LI>

	<LI>Failover cluster<BR><BR></LI>

	<LI>Replication server</LI>
</UL>

<P>For each installation step, the applicable components are listed.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;The service pack is language-specific. Apply the service pack with the same language as the SQL Server component that you are upgrading.</P>
</P><!--/NOTE-->
<H5>Before Starting an Installation</H5>

<P>An SP3 installation will fail if either of the following security policies has been set to <B>Do not allow installation</B>:

<UL type=disc>
	<LI>The <B>Devices: Unsigned driver installation behavior</B> local security policy for Windows XP <BR><BR></LI>

	<LI>The <B>Unsigned non-driver installation behavior</B> local security policy for Windows 2000</LI>
</UL>

<P>If you use the <B>Do not allow installation</B> setting, you must change it to <B>Silently succeed</B> before installing SP3. If necessary, you can return the policy to its previous setting after the installation is complete.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;<B>Do not allow installation</B> is not the default setting for these security policies.</P><!--/NOTE--></P>

<P>When installing this service pack on a pre-release version of Microsoft Windows .NET Server build 3683 or older, you will receive the following error message:</P>

<PRE><CODE>The software you are installing has not passed Windows Logo testing to 
verify its compatibility with this version of Windows. 
This software will not be installed. Contact your system administrator.</CODE></PRE>

<P>You can choose to ignore this message. Click <B>OK</B> to continue Setup.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;This message blocks an unattended installation.</P><!--/NOTE--></P>

<P>Before you install SP3 on the French version of Windows NT 4.0, follow the instructions in Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=9327" target=_blank>259484</A>. You can access the article from the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>. For instructions on searching the Knowledge Base, see Section 1.4 <A HREF="#_additional_information_about_sp3">Additional Information About SP3</A>.</P>

<H5>Before Starting a Database Components Installation</H5>

<P>If you apply Database Components SP3 to an instance of SQL Server on a computer on which Analysis Services is also installed, Setup may fail when executing the script, Sp3_serv_uni.sql. If this happens, restart the computer and run Setup again.</P>

<P>SP3 Setup does not upgrade user databases except for those user databases that are actively involved in replication topologies. Databases that are not involved in replication topologies do not have any dependencies on SP3. For example:

<UL type=disc>
	<LI>You can restore a user database backup from an instance of SQL Server 2000, SQL Server 2000 SP1, or SQL Server 2000 SP2 to an instance of SQL Server 2000 SP3.<BR><BR></LI>

	<LI>You can restore a user database backup from an instance of SQL Server 2000 SP3 to an instance of SQL Server 2000, SQL Server 2000 SP1, or SQL Server 2000 SP2.<BR><BR></LI>

	<LI>You can detach a user database from an instance of SQL Server 2000, SQL Server 2000 SP1, or SQL Server 2000 SP2 and attach it to an instance of SQL Server 2000 SP3.<BR><BR></LI>

	<LI>You can detach a user database from an instance of SQL Server 2000 SP3 and attach it to an instance of SQL Server 2000, SQL Server 2000 SP1, or SQL Server 2000 SP2.<BR><BR></LI>

	<LI>You can implement log shipping between instances of SQL Server 2000, SQL Server 2000 SP1, SQL Server 2000 SP2, and SQL Server 2000 SP3.</LI>
</UL>

<P>SP3 Setup upgrades user databases that are members of a replication topology. Before installing SP3, make sure that replication databases and filegroups are writable and that the user account that is running Setup has permission to access the databases. For more information about applying SP3 to databases that are included in replication topologies, see Section 3.11 <A HREF="#_installing_on_replicated_servers">Installing on Replicated Servers</A>.</P>

<P>If SP3 Setup detects user databases or filegroups that are not writable, it:

<UL type=disc>
	<LI>Applies the SP3 replication updates to all writable user databases.<BR><BR></LI>

	<LI>Writes a list of the non-writable databases to the Setup log, which is located at Winnt\Sqlsp.log.<BR><BR></LI>

	<LI>Displays the following warning message:
<PRE><CODE>Setup has detected one or more databases and filegroups which are not writable.</CODE></PRE>
</LI>
</UL>

<P>You can ignore this warning unless some of the databases listed in the Setup log are members of a replication topology. If any of the non-writable databases listed in the Setup log are members of a replication topology, you must make those databases writable and reapply SP3 Setup to that instance of SQL Server 2000. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;This message does not affect unattended installations. For more information about unattended installations, see Section 4.1 <A HREF="#_unattended_installations">Unattended Installations</A>.</P><!--/NOTE--></P>

<P>For more information about making a database writable, see Section 3.12 <A HREF="#_applying_sp3_to_read-only_databases_or_filegroups">Applying SP3 to Read-Only Databases or Filegroups</A>. For more information about reapplying SP3, see Section 3.14 <A HREF="#_reapplying_sp3">Reapplying SP3</A>.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;During installation, Setup makes no distinction between read-only databases and databases that are offline or in a suspect state. If a replication database or filegroup is in any of these conditions during setup and is involved in a replication topology, you must reapply the service pack after making the database writable.</P><!--/NOTE--></P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Because non-writable databases no longer cause Setup to fail, you do not have to remove log shipping before upgrading to SP3.</P><!--/NOTE--></P>

<H5>Preparing for a Systems Management Server Distributed Installation</H5>

<P>You cannot install SQL Server 2000 Service Pack 3 remotely. However, you can use Microsoft Systems Management Server to install SP3 automatically on multiple computers running Windows NT Server 4.0. To do so, you must use a package definition file (Smssql2ksp3.pdf) that automates the creation of a SQL Server package in Systems Management Server. The SQL Server package can then be distributed and installed on computers that are running Systems Management Server. The file Sms2kdef.bat is a batch file that starts an unattended setup using Systems Management Server. In this type of installation, the Setup program automatically detects relevant system information that it needs and no user input is required.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;You cannot use Systems Management Server to install Desktop Engine SP3.</P><!--/NOTE--></P>

<H2><A NAME="_back_up_your_sql_server_databases"></A>3.1 Back Up Your SQL Server Databases</H2>

<P>The following information applies to all component installations except database client components.</P>

<P>Before installing either Database Components SP3 or Desktop Engine SP3, back up the <B>master</B>, <B>msdb</B>, and <B>model </B>databases. Installing SP3 modifies the <B>master</B>, <B>msdb</B>, and <B>model </B>databases, making them incompatible with pre-SP3 versions of SQL Server. These backups are required if you decide to reinstall SQL Server 2000 without SP3.</P>

<P>It is also prudent to back up your user databases, although SP3 performs updates only on user databases that are members of replication topologies.</P>

<H2><A NAME="_back_up_your_analysis_services_databases"></A>3.2 Back Up Your Analysis Services Databases and Repository</H2>

<P>The following information applies only to Analysis Services. </P>

<P>Before installing Analysis Services SP3, back up your Analysis Services databases by making a copy of the Microsoft Analysis Services\Data folder, which is installed by default under the C:\Program Files folder. If you have not migrated your Analysis Services repository to SQL Server, make a backup copy of the file Msmdrep.mdb, which is located in the Microsoft Analysis Services\Bin folder. You should also save your Analysis server registry entries by running <B>Regedit.exe</B> and by using the <B>Export Registry File</B> item on the <B>Registry</B> menu to export the key <B>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\OLAP Server</B> to a file for backup. If you have migrated your Analysis Services repository to SQL Server, back up the database that contains the repository before installing SP3. For more information, see <A HREF="#_uninstalling_sql_server_2000_analysis_se_wluf">Uninstalling SQL Server 2000 Analysis Services SP3</A>.</P>

<H2><A NAME="_make_sure_that_the_system_databases_have_enough_free_space"></A>3.3 Make Sure the System Databases Have Enough Free Space</H2>

<P>The following information applies to all component installations except database client components and Analysis Services.</P>

<P>If the <B>autogrow</B> option is not selected for the <B>master</B> and <B>msdb</B> databases, the databases must have at least 500 kilobytes (KB) of free space. To verify that they have this space, run the <B>sp_spaceused</B> system stored procedure for the <B>master</B> or <B>msdb</B> database. If the unallocated space in either database is less than 500 KB, increase the size of the database. For more information, see "Expanding a Database" in SQL Server Books Online.</P>

<P>If the <B>autogrow</B> option is selected for the <B>master</B> and <B>msdb</B> databases, and there is sufficient room on the drives, you can skip this step.</P>

<P>To verify that the <B>autogrow</B> option is selected in SQL Server 2000, open SQL Server Enterprise Manager, right-click the icon for the database, and then click <B>Properties</B>. Verify that the <B>Automatically grow file</B> check box is selected. </P>

<P>To verify that this option is selected in Desktop Engine, issue the following SQL statements:

<UL type=disc>
	<LI><B>sp_helpdb master</B><BR><BR></LI>

	<LI><B>sp_helpdb msdb</B></LI>
</UL>

<P>In the output of these statements, verify that the value of the growth column is not 0.</P>

<H2><A NAME="_stop_services_and_applications_before_running_sp3_setup"></A>3.4 Stop Services and Applications Before Running SP3 Setup</H2>

<P>The following information applies to all components.</P>

<P>You can apply SP3 without shutting down services. If you do not shut down services, you are prompted to reboot the computer when Setup is complete. Without rebooting, the following services fail to start:

<UL type=disc>
	<LI>Microsoft Distributed Transaction Coordinator (MS DTC) and the Microsoft Search and MSSQLServerOLAPService services.<BR><BR></LI>

	<LI>The MSSQLServer and SQLServerAgent services for the instance being upgraded (for example, MSSQL$NamedInstance).<BR><BR></LI>

	<LI>Microsoft Component Services, Microsoft Message Queuing, and Microsoft COM Transaction Integrator.<BR><BR></LI>

	<LI>All applications, including Control Panel. (optional)</LI>
</UL>

<P>You can apply SP3 without restarting your computer by stopping the these services and applications before applying the SP3:</P>

<P>You cannot stop the services in a clustered environment. For more information, see Section 3.10 <A HREF="#_installing_on_a_failover_cluster">Installing on a Failover Cluster</A>.</P>

<H2><A NAME="_install_database_components_sp3"></A>3.5 Install Database Components SP3</H2>

<P>The following information applies to all component installations except Desktop Engine and Analysis Services.</P>

<P>Run the Setup.bat script from one of the following locations:

<UL type=disc>
	<LI>The directory on the local computer containing the extracted service pack files from SQL2KSP3.exe.<BR><BR></LI>

	<LI>The service pack directory on the SQL Server 2000 SP3 CD-ROM.<BR><BR></LI>

	<LI>The directory on the network share containing the extracted service pack files from SQL2KSP3.exe.</LI>
</UL>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;In order to install database components from a network share, you must first do one of the following:

<UL type=disc>
	<LI>Map the network share containing the extracted service pack files to an available drive letter on the local computer, navigate to the directory on the mapped drive that contains Setup.bat, and then run Setup.bat.<BR><BR></LI>

	<LI>Start Setup by running the Setupsql.exe file found in \X86\Setup, which is a subfolder of the directory on the network share containing the extracted service pack files.</P><!--/NOTE--></LI>
</UL>

<P>Setup displays a dialog box that prompts you for information, such as whether you want to use SQL Server Authentication or Windows Authentication. If you choose SQL Server Authentication, you must supply the Setup program with the password for the sa login. If you choose Windows Authentication, you must be running the Setup program while logged on to Windows using a Windows login account. This login account must be a part of the <B>sysadmin</B> fixed server role for the instance of SQL Server 2000 you are upgrading.</P>

<P>The Setup program then performs the following tasks:

<UL type=disc>
	<LI>Displays an <B>Authentication Mode</B> dialog box if it detects that the installation is using Mixed Mode Authentication with a blank password for the sa login. Leaving the sa login password blank provides users with easy administrative access to SQL Server or Desktop Engine and is not recommended; protect your systems by enforcing an sa password or by using Windows Authentication. To learn more about this dialog, see <A HREF="#_authentication_mode_dialog">Authentication Mode Dialog Box</A> later in this section.<BR><BR></LI>

	<LI>Displays an <B>SA Password Warning</B> dialog box if it detects a blank password for the sa login. Although you can continue your installation with a blank password for the sa login by explicitly choosing to ignore the recommendation and continue Setup, a blank password poses a security risk and is not recommended. This dialog is displayed regardless of the authentication mode you use.
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;This password change is made immediately; even if Setup fails, the password is still changed.</P><!--/NOTE--></p></LI>

	<LI>Displays a <B>Backward Compatibility Checklist</B> dialog box that warns of any backward compatibility issues that you may encounter when applying the service pack. To learn more about this dialog, see <A HREF="#_backward_compatibility_checklist_dialog__238p">Backward Compatibility Checklist Dialog Box</A> later in this section. <BR><BR></LI>

	<LI>Displays a dialog box if it detects that any databases or filegroups are not writable. At this point, if any of these databases or filegroups are part of a replication topology you can either:
<UL type=disc>
	<LI>Stop the setup process, make these objects writable, and restart Setup.<BR><BR></LI>

	<LI>Continue with the current SP3 setup process and reapply SP3 at a later time after making these objects writable.</LI>
</UL>

<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;The previous steps are necessary only when applying SP3 to non-writable databases or filegroups that are part of a replication topology. For more information, see Section 3.12 <A HREF="#_applying_sp3_to_read-only_databases_or_filegroups">Applying SP3 to Read-Only Databases or Filegroups</A>.</P><!--/NOTE--> </p></LI>

	<LI>Displays an <B>Error Reporting</B> dialog box with information about how to enable the new error reporting feature that is included in SP3. For more information about error reporting, see Section 5.10 <A HREF="#_5467_error_reporting_705">Error Reporting</A>.<BR><BR></LI>

	<LI>Updates MDAC components if necessary. For more information, see Section 5.5.1 <A HREF="#_microsoft_data_access_components_9s7l">Updates to Microsoft Data Access Components</A>.<BR><BR></LI>

	<LI>Replaces existing SQL Server 2000 files with SP3 files.<BR><BR></LI>

	<LI>Runs Transact-SQL script files to update system stored procedures.<BR><BR></LI>

	<LI>Displays an option to reboot the computer in the final dialog box if Setup determines that a reboot is needed. </LI>
</UL>

<H4><A NAME="_authentication_mode_dialog"></A>Authentication Mode Dialog Box</H4>

<P>The <B>Authentication Mode</B> dialog box does not default to the current settings for the installation. The dialog box defaults are:

<UL type=disc>
	<LI>On computers running Windows 98 or Windows Millennium Edition, the default setting is Mixed Mode Authentication (the only authentication mode supported on these operating systems). The dialog box prompts you to specify a password for the sa login. If you specify a password, Setup changes the sa login password. If you leave the password blank, Setup connects without changing the password. <BR><BR></LI>

	<LI>On computers running Windows NT 4.0 or Windows 2000, the default setting is Windows Authentication. Use the dialog box to switch to Windows Authentication Mode or Mixed Mode with an sa login password that is not blank.
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Before changing the authentication mode or the password for the sa login, make sure that this change does not affect existing applications. For example, if you change an instance of SQL Server from using Mixed Mode Authentication to using only Windows Authentication, existing applications attempting to connect using SQL Server Authentication cannot connect until the authentication mode is set to Windows Authentication. Also, if you change the sa login<B> </B>password, applications or administrative processes using the old password cannot connect until they are configured to use the new password.</p></P><!--/NOTE-->
<P class=atl><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;For security reasons, you should never have a blank password on the sa login.</P><!--/IMPORTANT--></p></LI>
</UL>

<P>The Setup program places a record of the actions it performs in the Sqlsp.log file. This log file is stored in the Windows directory of the computer on which Setup is run. If you upgrade multiple instances, only the most recent upgrade is recorded in this log.</P>

<H4><A NAME="_backward_compatibility_checklist_dialog__238p"></A>Backward Compatibility Checklist Dialog Box</H4>

<P>The <B>Backward Compatibility Checklist</B> dialog box lists backward compatibility issues that you may encounter when applying the service pack. The backward compatibility issues that appear in the checklist vary depending on the configuration of the instance of SQL Server 2000 that is being upgraded.</P>

<P>The following backward compatibility issues may be addressed in this dialog:

<UL type=disc>
	<LI>SP3 upgrades Microsoft Search service and automatically rebuilds the full-text catalogs for all applications using the service. During the rebuild, full-text functionality may not be fully available. You must select this check box before continuing Setup. For more information, see Section 5.1.5 <A HREF="#_full-text_catalogs_will_be_rebuilt_after_setup_completes">Full-Text Catalogs Are Rebuilt After Setup Completes</A>. <BR><BR></LI>

	<LI>Before you apply the service pack, you must upgrade your SQL Server 2000 master/target server configuration. The enhancements introduced with SP3 are compatible only with servers that are running SQL Server 2000 SP3. You must select this check box before continuing Setup. For more information, see Section 5.4.2 <A HREF="#_5464461_changes_to_master47target_server_533">Changes to Master/Target Server Configurations</A>.<BR><BR></LI>

	<LI>Cross-database ownership chaining is turned off by default in this service pack. After installation, you can enable cross-database ownership chaining for individual databases. Selecting this optional check box enables you to allow cross-database ownership chaining for all databases. For more information, see Section 5.1.11 <A HREF="#_enabling_cross45database_ownership_chain_ar5q">Cross-Database Ownership Chaining</A>.
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Enabling cross-database ownership chaining for all databases is not recommended.</P><!--/NOTE--></p>
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If you had previous enabled cross-database ownership chaining on a pre-release version of SP3 (before build 8.00.760) you will need to enable it again when installing the release version of SP3.</P><!--/NOTE--></p></LI>
</UL>

<H2><A NAME="_install_analysis_services_sp3"></A>3.6 Install Analysis Services SP3</H2>

<P>The following information applies only to Analysis Services. </P>

<P>To install Analysis Services SP3, run Setup.exe from either of the following locations:

<UL type=disc>
	<LI>The Msolap\Install subdirectory in the directory containing the extracted Analysis Services SP3 file from SQL2KASP3.exe.<BR><BR></LI>

	<LI>The Msolap\Install directory on the SP3 CD-ROM.</LI>
</UL>

<P>Setup then performs the following tasks:

<UL type=disc>
	<LI>Opens a Setup dialog box that prompts you for information.<BR><BR></LI>

	<LI>Displays an Error Reporting dialog box with information about how to enable the new error reporting feature included in SP3. For more information about error reporting, see 5.10 <A HREF="#_5467_error_reporting_705">Error Reporting</A>.<BR><BR></LI>

	<LI>Copies the necessary files, and completes the installation.</LI>
</UL>

<H5>Additional Analysis Services Installation Issues</H5>

<P>After installing Analysis Services SP3 you must also upgrade any computers used for remote administration to SP3. Otherwise, you receive the following error message when you attempt to connect remotely through Analysis Manager:</P>

<PRE><CODE>Unable to connect to the registry on the server (server_name), or you 
are not a member of the OLAP Administrators group of this server.</CODE></PRE>

<P>Meta Data Services has added a new dedicated role named <B>RepositoryUser</B>, which can be used to access and update repository information in the <B>msdb</B> database. The <B>RepositoryUser</B> role has create, read, update, delete, and execute permissions on the <B>msdb </B>repository. The <B>public</B> role has been replaced by this new role and no longer has permissions on this repository. If the following conditions are met, the <B>OLAP Administrators</B> group must be added to the <B>RepositoryUser</B> role so that members of this group can access the repository after the service pack is applied:

<UL type=disc>
	<LI>The repository is in the Meta Data Services format. <BR><BR></LI>

	<LI>The repository uses the <B>msdb</B> database.<BR><BR></LI>

	<LI>The <B>OLAP Administrators</B> group previously used the <B>public</B> role to access the repository.
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;This change also affects remote servers that access the Meta Data Services repository on a server that has been upgraded to SP3. Remote server logins must be added to the <B>RepositoryUser</B> role as well.</P><!--/NOTE--></p>
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;The <B>OLAP Administrators</B> group must be added to the <B>RepositoryUser</B> role before you restore a Meta Data Services repository that was backed up prior to upgrading to SP3; otherwise, the restore operation will fail.</P><!--/NOTE--></p></LI>
</UL>

<P>For more information about the <B>RepositoryUser</B> role, see Section 5.6.3 <A HREF="#_new_repositoryuser_role_needed_to_access_d3jb">New RepositoryUser Role for Accessing Repository Information</A>.</P>

<P>If the Analysis Services Data folder is located on a computer other than the one on which the Analysis server is running, you must modify the permissions on the folder after running SP 3 Setup. For more information, see Section 5.2.10 <A HREF="#_permissions_must_be_modified_on_a_remote_d3jb">Permissions Must be Modified on a Remote Data Folder</A>.</P>

<H2><A NAME="_install_desktop_engine_sp3"></A>3.7 Install Desktop Engine SP3</H2>

<P>The following information applies only to Desktop Engine.</P>

<P>The service pack for SQL Server 2000 Desktop Engine (also known as MSDE 2000) is intended for developers who create redistributable applications that use the Desktop Engine. Any instances of Desktop Engine that have been installed by a third-party application must be upgraded with a service pack supplied by the application vendor. If you are running an application that uses the Desktop Engine, contact your software provider for information about upgrading instances of the Desktop Engine that are installed by these applications. For more information, see the topic "Distributing the SQL Server 2000 Desktop Engine" in SQL Server Books Online. For information about the appropriate uses of Desktop Engine, see the <A HREF="http://go.microsoft.com/fwlink/?LinkId=10253" target=_blank>Microsoft SQL Server Web site for Desktop Engine</A>. For additional Desktop Engine SP3 installation information, see Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=12036" target=_blank>810826</A>.</P>

<P>The service pack for Desktop Engine is distributed in the following ways: 

<UL type=disc>
	<LI>On the SQL Server 2000 Service Pack 3 CD-ROM.<BR><BR></LI>

	<LI>Through SQL2KdeskSP3.exe. You can download this self-extracting file from the <A HREF="http://go.microsoft.com/fwlink/?LinkId=4172" target=_blank>Microsoft SQL Server Downloads Web site</A>. </LI>
</UL>

<P>Both delivery vehicles include all of the files that are required to install a new instance of Desktop Engine (.msi files), to upgrade all existing instances of Desktop Engine (.msp files), as well as to consume merge modules (.msm files) into applications. For more information, see "Distributing SQL Server Applications" in SQL Server Books Online or the Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=12036" target=_blank>810826</A>. You can access the article from the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>. </P>

<H4>File Locations</H4>

<P>This section describes the locations for files associated with Desktop Engine SP3.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If you install Desktop Engine as a component of another application, contact the software vendor for more information about upgrading Desktop Engine.</P><!--/NOTE--></P>

<P>All Desktop Engine installation files are located in the \MSDE directory or one of its subdirectories, which can be found:

<UL type=disc>
	<LI>On the CD-ROM <BR><BR></LI>

	<LI>In the directory containing the extracted service pack files from SQL2KDeskSP3.exe <BR><BR></LI>

	<LI>In the location on your hard drive or the network share to which you copied the \MSDE subdirectory from the CD-ROM.</LI>
</UL>

<P>Setup.exe is located in the \MSDE directory.</P>

<P>Installation packages (.msi files) are located in the \Setup subdirectory, which is a subfolder of the \MSDE folder that contains Setup.exe. </P>

<P>Windows Installer 2.0 (InstMsi20.exe) is located in the \MSI subdirectory.</P>

<P>The merge modules and related installation files are located in the \MSM subdirectory, which is a subfolder of the \MSDE folder containing Setup.exe. For a complete list of the available Desktop Engine merge modules, see the topic "Using SQL Server Desktop Engine Merge Modules" in SQL Server Books Online.</P>

<H4>Requirements</H4>

<P>The following requirements apply to Desktop Engine installations:

<UL type=disc>
	<LI>When upgrading Desktop Engine, you must apply Desktop Engine SP3 to every instance of Desktop Engine. 
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;The maximum number of instances supported for Desktop Engine is 16.</P><!--/NOTE--></p></LI>

	<LI>Always start Setup by running Setup.exe. Do not start Setup by directly invoking one of the .msi files.<BR><BR></LI>

	<LI>Regardless of whether an instance of Desktop Engine is using Windows or Mixed Mode authentication, Setup cannot proceed if a blank password is detected for the sa login. Setup displays a warning message if a blank password is detected. If you have a blank password on the sa login, before proceeding, you should change the password using <B>sp_password</B>.<BR><BR></LI>

	<LI>Problems can occur when you upgrade Desktop Engine to SP3 or when you install a new instance of Desktop Engine SP3 through a Terminal Services connection. If problems are encountered, restart Setup from the local computer.<BR><BR></LI>

	<LI>You can run Setup from your hard drive, a network share, or a CD-ROM. The Desktop Engine Setup program requires the original medium (for example, the original CD-ROM or network share) that you used to install Desktop Engine. <BR><BR></LI>

	<LI>If Desktop Engine was originally installed from a CD-ROM or from a network share that has been moved, copy the Desktop Engine subdirectory from the SQL Server 2000 Desktop Engine Service Pack 3 CD-ROM to your hard drive or the network share, and then run Setup.exe.<BR><BR></LI>

	<LI>You can install the upgrade for Desktop Engine from a CD-ROM only if the following conditions are met:
<UL type=disc>
	<LI>You are using Windows Installer version 2.0.2600.0 or later.<BR><BR></LI>

	<LI>If you create your own CD-ROM for installing SP3, the volume label on the CD-ROM must be <I>SQL2KSP3</I>. If you are an independent software vendor (ISV) creating a CD-ROM for the purpose of distributing Desktop Engine as a component of your application, the CD-ROM volume label must be identical to the <B>VolumeLabel</B> property in the <B>Media</B> table of the Windows Installer package (*.msi).</LI>
</UL>
</LI>
</UL>

<P>If you need to upgrade Windows Installer, SP3 includes the files needed to upgrade Windows Installer. </P>

<P class=label><B>To upgrade Windows Installer:</B>

<OL>
	<LI>Run InstMsi20.exe located in \MSI which is a subfolder of the \MSDE folder that contains Setup.exe.<BR><BR></LI>

	<LI>When prompted, reboot the computer.</LI>
</OL>

<H4>Desktop Engine Setup Arguments</H4>

<P>Desktop Engine Setup supports the following setup parameters in SP3. </P>

<TABLE border=1 cellpadding=2 cols=2 frame=box rules=rows width=614>

<TR VALIGN="top">
<TH class=label width=33%>Parameter name</TH>
<TH class=label width=67%>Description</TH>
</TR>

<TR VALIGN="top">
<TD width=33%><B>ALLOWXDBCHAINING</B>=<B>1</B></TD>
<TD width=67%>Enables cross-database ownership chaining. For more information, see Section 5.1.11 <A HREF="#_enabling_cross45database_ownership_chain_ar5q">Cross-Database Ownership Chaining</A>.</TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>BLANKSAPWD</B>=<B>1</B></TD>
<TD width=67%>Overrides the default behavior of the installer, which is to prohibit installation with a blank sa password. If you set <B>BLANKSAPWD=1</B>, the installer allows installation with a blank sa password.
<P><!--WARNING--><P ID="Alert_Warning"><B CLASS="notes">Warning</B>&nbsp;&nbsp;The use of blank passwords is strongly discouraged.</P><!--/WARNING--> </P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>INSTANCENAME</B>=
<P><I>instance_name</I></P>
</TD>
<TD width=67%>Specifies the name for the instance. If no instance name is specified, the default instance name MSSQLSERVER is used.</TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>SAPWD</B>=<I>sa_password</I></TD>
<TD width=67%>Specifies the sa password. This option can be used for new installations. Unlike other properties, the <B>SAPWD</B> property is hidden and the value is not written to the log file.</TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>SECURITYMODE</B>=<B>SQL</B></TD>
<TD width=67%>Specifies that the instance use SQL Server Authentication. In Windows NT 4.0, Windows 2000, or Windows XP, if <B>SECURITYMODE</B>=<B>SQL</B> is not specified, Windows Authentication is used and the Windows local administrator's group is added to the SQL Server <B>sysadmin</B> fixed server role. 
<P><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;When possible, use Windows Authentication.</P><!--/IMPORTANT--></P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>UPGRADEUSER</B>=<B>sa</B></TD>
<TD width=67%>Specifies the login to be used when you upgrade Desktop Engine using SQL Server Authentication. The login must be a member of the <B>sysadmin</B> fixed server role. </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>UPGRADEPWD</B>=
<P>sa_password</P>
</TD>
<TD width=67%>Specifies the password for the login that is used when you upgrade Desktop Engine using SQL Server Authentication. </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>UPGRADE=1</B></TD>
<TD width=67%>Used when upgrading an instance of Microsoft Desktop Engine version 1.0 to SQL Server 2000 Desktop Engine SP3. The only value supported is <B>1</B>. </TD>
</TR>
</TABLE><BR>

<P>Setup parameters can be specified either in the command line or in an .ini file. For information, see the topic "Customizing Desktop Engine Setup.exe" in SQL Server Books Online.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;When using the SQL Server 2000 Desktop Engine merge modules as an integrated part of a custom setup, you may not be able to customize the Desktop Engine installation using these command-line parameters. For more information, see Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=12036" target=_blank>810826</A>. </P><!--/NOTE--></P>

<P class=indent><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;Avoid storing credentials in an .ini file.</P><!--/IMPORTANT--></P>

<P>The following setup switches are used when upgrading, installing, or uninstalling Desktop Engine.</P>

<TABLE border=1 cellpadding=2 cols=2 frame=box rules=rows width=614>

<TR VALIGN="top">
<TH class=label width=36%>Switch name</TH>
<TH class=label width=64%>Description</TH>
</TR>

<TR VALIGN="top">
<TD width=36%>/<B>upgradesp</B> &lt;<I>setup_path&gt;\SqlRunXX.msi</I> | <B>SQLRUN</B></TD>
<TD width=64%>For SP3 and later, this switch replaces the /<B>p </B>switch that you use when specifying the location of packages. When upgrading to SP3, if you know the number of the original MSI that was used to install Desktop Engine, specify it along with the full path to the location of the SP3 .msi file with the same name. Or, you can specify <B>SQLRUN</B> if you specify your instance name with the <B>INSTANCENAME</B> parameter. For examples of how to use this new switch, see the following section.</TD>
</TR>

<TR VALIGN="top">
<TD width=36%>/<B>l*v </B>[<I>filename</I>]</TD>
<TD width=64%>This standard setup switch is useful when troubleshooting an installation. It specifies that a verbose log be created. If <I>filename</I> is specified, the log is stored in the file specified.</TD>
</TR>

<TR VALIGN="top">
<TD width=36%>/<B>x </B><I>package_name</I></TD>
<TD width=64%>This standard setup switch is used when uninstalling Desktop Engine. You must specify the name of the Windows Installer installation package (.msi) file that was used to install the instance of Desktop Engine. </TD>
</TR>
</TABLE><BR>

<P>For information about other Setup arguments, see the topic "Customizing Desktop Engine Setup.exe" in SQL Server Books Online. </P>

<H4>Upgrading an Existing Instance of Desktop Engine</H4>

<P>SP3 introduces a new switch for upgrading Desktop Engine. The <B>/upgradesp</B> switch replaces the <B>/p</B> switch. When using this new switch, you have two options, depending on the information that you have about the instance of Desktop Engine that you are upgrading. You must either know the instance name (the default is MSSQLSERVER) or you must know which .msi file was originally used to install Desktop Engine. </P>

<P>If you know the instance name, use the <B>/upgradesp</B> switch as shown in the following example:</P>

<PRE><CODE>Setup.exe /upgradesp SQLRUN INSTANCENAME=<I>instance_name </I>SECURITYMODE=SQL 
UPGRADEUSER=&lt;<I>username</I>&gt; UPGRADEPWD=&lt;<I>password</I>&gt;</CODE></PRE>

<P class=indent><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;If you use an .ini file during setup, avoid storing credentials in the .ini file.</P><!--/IMPORTANT--></P>

<P>In this case, the installer uses the instance name to determine which .msi file was originally used to install Desktop Engine. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;When upgrading the default instance, you do not have to specify <B>INSTANCENAME</B>.</P><!--/NOTE--></P>

<P>Desktop Engine can be installed with one of 16 .msi files (SqlRun01.msi through SqlRun16.msi). If you know the name of the original .msi file that was used to install Desktop Engine, you can specify it along with the complete path to the SP3 .msi file of the same name, as shown in the following example:</P>

<PRE><CODE>Setup.exe /upgradesp c:\SQL2KSP3\MSDE\Setup\SqlRun03.msi SECURITYMODE=SQL 
UPGRADEUSER=&lt;<I>username</I>&gt; UPGRADEPWD=&lt;<I>password</I>&gt;</CODE></PRE>

<P class=indent><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;If you use an .ini file during setup, avoid storing credentials in the .ini file.</P><!--/IMPORTANT--></P>

<P>In this example, C:\SQL2KSP3\MSDE\Setup represents the location of the SP3 .msi files and SqlRun03.msi is the name of the .msi file used in the original installation. </P>

<P>If you do not know either the instance name or the name of the original .msi file, see Microsoft Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=10254" target=_blank>311762</A>. This article describes how to determine the name of the original .msi file. You can access the article from the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>.</P>

<H5>Upgrading SQL Server 2000 Desktop Engine </H5>

<P class=label><B>To upgrade SQL Server 2000 Desktop Engine</B>

<OL>
	<LI>Run Setup.exe to initiate setup. (Do not run Setup directly from the .msi file.)<BR><BR></LI>

	<LI>If the instance name is known, use /<B>upgradesp</B> SQLRUN <B>INSTANCENAME</B>=<I>instance_name</I>
<P class=tl>-or-</P>
<P class=tl>If the name of the original .msi file is known, use /<B>upgradesp</B> and specify the name of the .msi file along with the complete path to the SP3 .msi file of the same name.</P></LI>

	<LI>Specify <B>SECURITYMODE</B>=<B>SQL</B>.<BR><BR></LI>

	<LI>Use the UPGRADEUSER parameter to specify a login account for Setup to use that is a member of the sysadmin fixed server role.<BR><BR></LI>

	<LI>Use the UPGRADEPWD setup parameter to specify the password for the chosen login account. </LI>
</OL>

<P class=indent><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;If you use an .ini file during setup, avoid storing credentials in the .ini file.</P><!--/IMPORTANT--></P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If you use <B>BLANKSAPWD=1</B>, you are not required to specify <B>SECURITYMODE=SQL</B> or <B>UPGRADEUSER</B> and <B>UPGRADEPWD</B>.</P><!--/NOTE--></P>

<P class=indent><!--WARNING--><P ID="Alert_Warning"><B CLASS="notes">Warning</B>&nbsp;&nbsp;The use of blank passwords is strongly discouraged.</P><!--/WARNING--></P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;When upgrading Desktop Engine on a computer running Windows 98 or Windows Millennium Edition, the instance of Desktop Engine that you are upgrading must be stopped before starting Setup.</P><!--/NOTE--></P>

<H5>Upgrading from Desktop Engine version 1.0</H5>

<P class=label><B>To upgrade from Desktop Engine version 1.0</B></P>

<P>This service pack supports the capability to upgrade an instance of Desktop Engine version 1.0 directly to SQL Server 2000 Desktop Engine SP3. To upgrade Desktop Engine:

<OL>
	<LI>Stop the instance of Desktop Engine 1.0 that you are upgrading.<BR><BR></LI>

	<LI>Run Setup.exe to initiate setup. (Do not run Setup directly from the .msi file.)<BR><BR></LI>

	<LI>Specify <B>UPGRADE=1</B></LI>
</OL>

<P>If you are using SQL Server Authentication, you also need to do the following:

<OL start=4>
	<LI>Specify <B>SECURITYMODE</B>=<B>SQL</B>.<BR><BR></LI>

	<LI>Use the UPGRADEUSER parameter to specify a login account for Setup to use that is a member of the sysadmin fixed server role.<BR><BR></LI>

	<LI>Use the UPGRADEPWD setup parameter to specify the password for the chosen login account. </LI>
</OL>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If you use <B>BLANKSAPWD=1</B>, you are not required to specify <B>SECURITYMODE=SQL</B> or <B>UPGRADEUSER</B> and <B>UPGRADEPWD</B>.</P><!--/NOTE--></P>

<P class=indent><!--WARNING--><P ID="Alert_Warning"><B CLASS="notes">Warning</B>&nbsp;&nbsp;The use of blank passwords is strongly discouraged.</P><!--/WARNING--></P>

<P class=indent><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;If you use an .ini file during setup, avoid storing credentials in the .ini file.</P><!--/IMPORTANT--></P>

<H5>Installing a New Instance of Desktop Engine</H5>

<P>SP3 allows you to install a new instance of Desktop Engine. </P>

<P class=label><B>To install a new instance of Desktop Engine</B>

<UL type=disc>
	<LI>Run Setup.exe to initiate Setup. (Do not run Setup directly from the .msi file.)<BR><BR></LI>

	<LI>If you are using SQL Server Authentication, specify <B>SECURITYMODE</B>=<B>SQL</B>.<BR><BR></LI>

	<LI>Regardless of the authentication mode, you must do one of the following:
<UL type=disc>
	<LI>Specify a password for the sa login using the <B>SAPWD</B> setup parameter.<BR><BR></LI>

	<LI>Specify the <B>BLANKSAPWD</B>=<B>1 </B>parameter. </LI>
</UL>

<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If both <B>SAPWD</B> and <B>BLANKSAPWD</B> are specified, <B>SAPWD</B> takes precedence and <B>BLANKSAPWD</B> is ignored.</P><!--/NOTE--></p>
<P class=atl><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;If you are using an .ini file during setup, avoid storing credentials in the .ini file.</P><!--/IMPORTANT--></p>
<P class=atl><!--WARNING--><P ID="Alert_Warning"><B CLASS="notes">Warning</B>&nbsp;&nbsp;The use of blank passwords is strongly discouraged.</P><!--/WARNING--></p></LI>
</UL>

<P>For additional information, see the topic "Installing Desktop Engine" in SQL Server Books Online. For information about the appropriate uses of Desktop Engine, see the <A HREF="http://go.microsoft.com/fwlink/?LinkId=10253" target=_blank>Microsoft SQL Server Web site for Desktop Engine</A>.</P>

<H5>Redistributing the Service Pack</H5>

<P>It is recommended that ISVs who want to redistribute this service pack do so in one of the following ways:

<UL type=disc>
	<LI>For installations that use Setup.exe, install the service pack on an instance of Desktop Engine that is configured to match the one distributed with your software.<BR><BR></LI>

	<LI>For installations that use merge modules, generate your own patch package based on the differences between the old and new installations, and then distribute your custom patch to your customers.</LI>
</UL>

<P>For more information about creating patch packages, see Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=12036" target=_blank>810826</A> or the documentation included with the Windows Installer Software Development Kit (SDK), which can be downloaded from the <A HREF="http://go.microsoft.com/fwlink/?LinkId=4435" target=_blank>Microsoft Platform SDK Web site</A>.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;You can redistribute a complete copy of SP3.</P><!--/NOTE--></P>

<H2><A NAME="_restart_services"></A>3.8 Restart Services</H2>

<P>The following information applies to all components.</P>

<P>When Setup completes, it may prompt you to restart the system. After the system restarts (or after Setup completes without requesting a restart), use the Services application in Control Panel to make sure that MS DTC and the Microsoft Search, MSSQLServer, MSSQLServerOLAPService, and SQLServerAgent services or their instance-specific equivalents are running. Back up the upgraded <B>master</B> and <B>msdb</B> databases.</P>

<H2><A NAME="_restart_applications"></A>3.9 Restart Applications</H2>

<P>The following information applies to all components.</P>

<P>Restart the applications you closed before running the service pack Setup program.</P>

<H2><A NAME="_installing_on_a_failover_cluster"></A>3.10 Installing on a Failover Cluster</H2>

<P>The following information applies only to SQL Server 2000 components that are part of a failover cluster. </P>

<P class=proclabel><B>To install the service pack on a failover cluster</B>

<OL>
	<LI>If any resources have been added with dependencies on SQL Server resources, those dependencies must either be removed or taken offline before you install SP3. If you do not do this, the installation of SP3 may cause those dependent resources to fail over.<BR><BR></LI>

	<LI>Run the service pack from the node that owns the group containing the virtual server that you are going to upgrade. This installs the service pack files on all nodes in the failover cluster.<BR><BR></LI>

	<LI>In the <B>Setup</B> dialog box, type the name of the virtual server that you are upgrading.<BR><BR></LI>

	<LI>Keep all nodes of the cluster online during setup. This ensures that the upgrade is applied to each node of the cluster.<BR><BR></LI>

	<LI>If you removed dependencies or took resources offline in Step 1 above, add back the dependencies or bring the resources back online.</LI>
</OL>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Setup might require rebooting of the failover cluster nodes. This replaces the files that were in use during setup with the updated files. </P><!--/NOTE--></P>

<P>If you are upgrading a default (non-clustered) instance of SQL Server to a virtual server, first, you must upgrade the default (non-clustered) instance to a virtual instance, and then apply SP3. For more information about upgrading, see "How to upgrade from a default instance to a default clustered instance of SQL Server 2000 (Setup)" in SQL Server Books Online.</P>

<P>For additional information on installing SP3 on a failover cluster, see Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=12110" target=_blank>811168</A>. </P>

<P class=proclabel><B>If you need to rebuild a node in the failover cluster, perform the following steps</B>

<OL>
	<LI>Rebuild the node in the failover cluster. For more information about rebuilding a node, see "How to recover from failover cluster failure in Scenario 1" in SQL Server Books Online.<BR><BR></LI>

	<LI>Run the original SQL Server 2000 Setup program to add the node back to the failover cluster.<BR><BR></LI>

	<LI>Run SP3 Setup. </LI>
</OL>

<P>When installing Analysis Services SP3 on a cluster, each instance must be upgraded separately.</P>

<P class=proclabel><B>To install SP3 on an Analysis Services cluster</B>

<OL>
	<LI>Install SP3 on a failover node.<BR><BR></LI>

	<LI>Fail over to the newly upgraded node.<BR><BR></LI>

	<LI>Repeat steps 1 and 2 until all instances in the cluster are upgraded.</LI>
</OL>

<H2><A NAME="_installing_on_replicated_servers"></A>3.11 Installing on Replicated Servers</H2>

<P>The following information applies only to SQL Server 2000 components that are part of a replication topology:

<UL type=disc>
	<LI>You must upgrade the Distributor before you upgrade the Publisher<BR><BR></LI>

	<LI>For replication topologies based on transactional replication with read-only Subscribers, you can upgrade the Subscriber before or after the Publisher and Distributor. <BR><BR></LI>

	<LI>For replication topologies based on merge replication or transactional replication with updating Subscribers, you must upgrade the Subscriber after the Publisher and Distributor.</LI>
</UL>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;In many cases, especially in merge replication, the Distributor and Publisher are on the same server and are upgraded at the same time.</P><!--/NOTE--></P>

<H5>Installing SP3 on a Server that Acts as a Publisher and a Subscriber</H5>

<P>For replication topologies based on merge replication or transactional replication with updating Subscribers that include one or more servers that act as both a Subscriber and a Publisher (or Distributor), you might need to quiesce the system (in other words, stop all updates) and upgrade all servers simultaneously. </P>

<H6>Example 1: Topology That Requires Simultaneous Upgrades</H6>

<P>The following table includes servers that both publish and subscribe to publications that allow updates at the Subscriber. As noted earlier, you must follow the upgrade order Distributor, Publisher, Subscriber for topologies that allow updates at the Subscriber. This order requires you to upgrade Server A first for the merge publication and Server B first for the transactional publication with updating Subscribers. In this case, you must quiesce the system and upgrade the servers simultaneously.</P>

<TABLE border=1 cellpadding=2 cols=2 frame=box rules=rows width=614>

<TR VALIGN="top">
<TH class=label width=49%>Server A</TH>
<TH class=label width=51%>Server B</TH>
</TR>

<TR VALIGN="top">
<TD width=49%>Publisher/Distributor for merge replication</TD>
<TD width=51%>Subscriber for merge replication</TD>
</TR>

<TR VALIGN="top">
<TD width=49%>Subscriber for transactional replication with updating</TD>
<TD width=51%>Publisher/Distributor for transactional replication with updating</TD>
</TR>
</TABLE><BR>

<H6>Example 2: Topology That Allows Sequential Upgrades</H6>

<P>In this example, you can upgrade Server A first because the read-only transactional publication allows a Subscriber to be upgraded before the Publisher/Distributor.</P>

<TABLE border=1 cellpadding=2 cols=2 frame=box rules=rows width=614>

<TR VALIGN="top">
<TH class=label width=49%>Server A</TH>
<TH class=label width=51%>Server B</TH>
</TR>

<TR VALIGN="top">
<TD width=49%>Publisher/Distributor for merge replication</TD>
<TD width=51%>Subscriber for merge replication</TD>
</TR>

<TR VALIGN="top">
<TD width=49%>Subscriber for read-only transactional replication</TD>
<TD width=51%>Publisher/Distributor for read-only transactional replication</TD>
</TR>
</TABLE><BR>

<H5>Additional Replication Installation Issues</H5>

<P class=indent><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;Before you upgrade to SP3, ensure that the Windows account under which the SQL Server service runs is a member of the <B>sysadmin</B> fixed server role. You must do this because replication distribution databases are upgraded under the context of the SQL Server service account. After upgrading to SP3, you should remove the Windows account from the <B>sysadmin</B> role.</P><!--/IMPORTANT--></P>

<P>If you are using merge replication and the Distributor is located on another computer or database instance (a remote Distributor), after applying SP3 you must generate a new snapshot.</P>

<P>SP3 introduces a change in the requirements for attaching or restoring replication databases. For more information, see Section 5.3.17 <A HREF="#_change_to_requirements_for_attaching_40o_wluf">Change to Requirements for Attaching or Restoring a Replication Database</A>.</P>

<P>SP3 Setup upgrades user databases that are members of a replication topology. If any of the databases that are members of a replication topology are non-writable, to apply SP3 to those databases you must make them writable, and then reapply SP3 Setup. For more information about making a database writable, see Section 3.12 <A HREF="#_applying_sp3_to_read-only_databases_or_filegroups">Applying SP3 to Read-Only Databases or Filegroups</A>. For information about reapplying SP3, see Section 3.14 <A HREF="#_reapplying_sp3">Reapplying SP3</A>.</P>

<P>An existing backup scheme that accounts for replication allows you to restore a database to a known point after the SP3 upgrade in case of a failure. After applying SP3, a log or full database backup is recommended for any user database that is included in a replication topology. This way, if a replication database fails, you do not have to reapply SP3 after the database is restored.</P>

<H2><A NAME="_applying_sp3_to_read-only_databases_or_filegroups"></A>3.12 Applying SP3 to Read-Only Databases or Filegroups</H2>

<P>The following information applies only to SQL Server 2000 components that are part of a replication topology.</P>

<P>When non-writable databases or filegroups exist, Setup displays the following message:</P>

<PRE><CODE>Setup has detected one or more databases and filegroups which are not writable.</CODE></PRE>

<P>In general, you can ignore this warning and setup will continue. However, if any of the non-writable databases listed in the Setup log are members of a replication topology, you must make those databases writable and reapply SP3 Setup to that instance of SQL Server 2000. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;This message does not affect unattended installations. For more information about unattended installations, see Section 4.1 <A HREF="#_unattended_installations">Unattended Installations</A>.</P><!--/NOTE--></P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;During installation, Setup makes no distinction between non-writable databases and databases that are offline or in a suspect state. If a database or filegroup is in any of these conditions during setup, you must reapply the service pack. For more information about bringing a database online, see the topic "Attaching and Detaching a Database" in SQL Server Books Online. For more information about diagnosing suspect databases, see the topic "Server and Database Troubleshooting" in SQL Server Books Online.</P><!--/NOTE--></P>

<P class=label><B>To apply SP3 to a read-only database</B>

<OL>
	<LI>Make the read-only database writable using the <B>ALTER DATABASE</B> statement, as follows:
<PRE><CODE>ALTER DATABASE <I>database</I> SET READ_WRITE</CODE></PRE>
</LI>

	<LI>Repeat Step 1 for all read-only databases.<BR><BR></LI>

	<LI>Apply (or reapply) the service pack.<BR><BR></LI>

	<LI>If required, make the database read-only again using <B>ALTER DATABASE</B>, as follows:
<PRE><CODE>ALTER DATABASE <I>database</I> SET READ_ONLY</CODE></PRE>
</LI>
</OL>

<P class=proclabel><B>To apply SP3 to a read-only filegroup</B>

<OL>
	<LI>Make the read-only filegroup writable using <B>ALTER DATABASE</B>, as follows:
<PRE><CODE>ALTER DATABASE <I>Database</I> 
MODIFY FILEGROUP <I>filegroup_name</I> READWRITE </CODE></PRE>
</LI>

	<LI>Repeat Step 1 for all read-only filegroups.<BR><BR></LI>

	<LI>Apply (or reapply) the service pack.<BR><BR></LI>

	<LI>Make the filegroup read-only again using <B>ALTER DATABASE</B>, as follows:
<PRE><CODE>ALTER DATABASE <I>Database</I> 
MODIFY FILEGROUP <I>filegroup_name</I> READONLY</CODE></PRE>
</LI>
</OL>

<P>For more information about <B>ALTER DATABASE</B>, see the "ALTER DATABASE" reference topic in SQL Server Books Online. For more information about reapplying SP3, see Section 3.14 <A HREF="#_reapplying_sp3">Reapplying SP3</A>.</P>

<H2><A NAME="_uninstalling_sp3"></A>3.13 Uninstalling SP3</H2>

<P>They way in which you remove SQL Server SP3 depends on the SQL Server 2000 SP3 components that you are removing.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;MDAC updates are not uninstalled. For more information, see Section 5.5.1 <A HREF="#_microsoft_data_access_components_9s7l">Updates to Microsoft Data Access Components</A>.</P><!--/NOTE--></P>

<H4><A NAME="_uninstalling_sql_server_2000_components__d3jb"></A>Uninstalling SQL Server 2000 Components and Desktop Engine SP3</H4>

<P>To revert to the pre-SP3 versions of SQL Server 2000 components, you must have back ups of the <B>master</B>,<B> msdb</B>,<B> </B>and <B>model </B>databases taken prior to installing SP3. For more information, see Section 3.1 <A HREF="#_back_up_your_sql_server_databases">Back Up Your SQL Server Databases</A>.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If any of the databases are involved in replication, you must disable publishing. To disable publishing:

<OL>
	<LI>In SQL Server Enterprise Manager, expand a SQL Server group, expand a server, right-click the <B>Replication</B> folder, and then click <B>Configure Publishing, Subscribers, and Distribution</B>.<BR><BR></LI>

	<LI>Click the <B>Publication Databases</B> tab.<BR><BR></LI>

	<LI>Clear the check box for each database that is involved in replication. This allows the databases to be detached.</P><!--/NOTE--></LI>
</OL>

<P class=proclabel><B>To revert to the pre-SP3 version of SQL Server</B>

<OL>
	<LI>Detach all user databases. For more information, see "How to attach and detach a database (Enterprise Manager)" in SQL Server Books Online.<BR><BR></LI>

	<LI>Uninstall SQL Server. In <B>Control Panel</B>, double-click <B>Add/Remove Programs</B>, and then select the instance of SQL Server that you want to uninstall.<BR><BR></LI>

	<LI>Install SQL Server 2000 from the CD-ROM or the location from which you originally installed SQL Server.<BR><BR></LI>

	<LI>Apply any service packs and QFE fixes that were installed prior to SP3.<BR><BR></LI>

	<LI>Restore the databases <B>master</B>, <B>msdb</B>, and <B>model</B> from the last backup that was created before applying SP3. This automatically attaches any user databases that were attached at the time the backup was created, assuming that the location of the data files has not changed.<BR><BR></LI>

	<LI>Attach any user databases that were created after the last backup of the <B>master</B> database.<BR><BR></LI>

	<LI>Configure replication if necessary.
<P class=atl><!--WARNING--><P ID="Alert_Warning"><B CLASS="notes">Warning</B>&nbsp;&nbsp;When you revert to the pre-SP3 version of SQL Server, all changes made to the databases <B>master</B>, <B>msdb</B>, and <B>model</B> since applying SP3 are lost.</P><!--/WARNING--></p></LI>
</OL>

<H4><A NAME="_uninstalling_sql_server_2000_analysis_se_wluf"></A>Uninstalling SQL Server 2000 Analysis Services SP3</H4>

<P>To be able to return Analysis Services to its pre-SP3 state, you must back up the <B>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\OLAP Server</B> registry key prior to installing SP3. For more information, see Section 3.2 <A HREF="#_back_up_your_analysis_services_databases">Back Up Your Analysis Services Databases and Repository</A>. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If you did not backup this registry key, you must follow the process documented in Microsoft Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=11584" target=_blank>330244</A>. </P><!--/NOTE--></P>

<P class=proclabel><B>To revert to the pre-SP3 version of SQL Server</B>

<OL>
	<LI>Uninstall SQL Server 2000 Analysis Services. In <B>Control Panel</B>, double-click <B>Add/Remove Programs</B>, click <B>SQL Server 2000 Analysis Services</B>, and click <B>Remove</B>. <BR><BR></LI>

	<LI>Reinstall SQL Server 2000 Analysis Services from the CD-ROM or the location from which you originally installed Analysis Services.<BR><BR></LI>

	<LI>Apply any service packs and QFE fixes that were installed prior to installing SP3.<BR><BR></LI>

	<LI>Remove the <B>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\OLAP Server</B> registry key.<BR><BR></LI>

	<LI>Reinstall the <B>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\OLAP Server</B> registry key from the pre-SP3 backup.</LI>
</OL>

<H2><A NAME="_reapplying_sp3"></A>3.14 Reapplying SP3</H2>

<P>The following information applies to all components.</P>

<P>In the following cases, you must reapply SP3: 

<UL type=disc>
	<LI>If new SQL Server 2000 components are added after SP3 is applied. <BR><BR></LI>

	<LI>If databases or filegroups that are part of a replication topology and were read-only during the initial application of SP3 are made writable.</LI>
</UL>

<P>To reapply SP3, follow the steps in Section 3.0 <A HREF="#_service_pack_installation">Service Pack Installation</A>.</P>

<H1><A NAME="_additional_installation_considerations"></A>4.0 Additional Installation Considerations</H1>

<P>This section documents additional service pack installation considerations that apply only in special cases. </P>

<H2><A NAME="_unattended_installations"></A>4.1 Unattended Installations</H2>

<P>Database Components SP3 can be applied in unattended mode to an instance of SQL Server. The Database Components SP3 CD-ROM contains .iss files that can be used to perform unattended SP3 setups and other types of installations. The following files are located in the root directory on the CD-ROM:

<UL type=disc>
	<LI>Sql2kdef.iss is the unattended setup file used to apply Database Components SP3 to a default instance of SQL Server 2000 running on Windows 2000 or Windows NT 4.0. The corresponding batch file to use is Sql2kdef.bat. <BR><BR></LI>

	<LI>Sql2knm.iss is the setup file used to apply Database Components SP3 to a named instance of SQL Server 2000 running on Windows 2000 or Windows NT 4.0. You must change the instance name in this .iss file to identify the instance that is being upgraded.<BR><BR></LI>

	<LI>Sql2ktls.iss is the setup file used to apply Database Components SP3 to a tools-only installation. This file can be used for installation without any modifications.<BR><BR></LI>

	<LI>Sql2k9x.iss is the setup file used to apply Database Components SP3 on a computer running Windows Millennium Edition or Windows 98. You must change the instance name in this .iss file to identify the instance being upgraded.<BR><BR></LI>

	<LI>Sql2kcli.iss is the setup file used to apply Database Components SP3 to a client component installation on a computer running Windows 95.<BR><BR></LI>

	<LI>Msolap.iss is the setup file that stores the list of parameters for running an unattended setup of Analysis Services SP3.</LI>
</UL>

<P>For more information about performing unattended installations of SQL Server 2000, see the topic "Performing an Unattended Installation" in SQL Server Books Online.</P>

<H5>Unattended Installation Considerations</H5>

<P>The following considerations relate to unattended installations:

<UL type=disc>
	<LI>Run unattended installations using Windows Authentication whenever possible. <BR><BR></LI>

	<LI>If you must run an unattended setup using SQL Server Authentication; for example if you are running an unattended setup of SP3 on a computer running Windows 98 or Windows Millennium Edition, you should not include a password for the sa login in the .iss file or batch file because these files are not encrypted. Instead, you should supply the password for the sa login in the command line using the <I>sapwd</I> parameter as follows:
<PRE><CODE>start /wait setupsql.exe -s -sms -f1 C:\sql2knm.iss -sapwd <I>password</I> </CODE></PRE>
</LI>

	<LI>If the SQL Server instance being upgraded to SP3 has a blank password for the sa login account, a password must be provided prior to running an unattended installation. You should change this password by running <B>sp_password</B>.<BR><BR></LI>

	<LI>When running an unattended installation of SP3, you must manually set the following setup switches that correspond to the <B>Backward Compatibility Checklist</B> dialog box or the unattended installation will fail.</LI>
</UL>

<TABLE border=1 cellpadding=2 cols=2 frame=box rules=rows width=614>

<TR VALIGN="top">
<TH class=label width=33%>Unattended setup switch</TH>
<TH class=label width=67%>Description</TH>
</TR>

<TR VALIGN="top">
<TD width=33%><B>UpgradeMSSearch</B></TD>
<TD width=67%>This switch is required to address the required rebuild of full-text catalogs. If Full Text Search is enabled, you must set this switch to <B>1</B>. For more information, see Section 5.1.5 <A HREF="#_full-text_catalogs_will_be_rebuilt_after_setup_completes">Full-Text Catalogs are Rebuilt After Setup Completes</A>. </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>MSXTSXUpgraded</B></TD>
<TD width=67%>This switch is required to address the issue regarding upgrading master/target server configurations. If you are applying SP3 to a master or target server, you must set this switch to <B>1</B>. For more information, see Section 5.4.2 <A HREF="#_5464461_changes_to_master47target_server_533">Changes to Master/Target Server Configurations</A>. </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>EnableCrossDBChaining</B></TD>
<TD width=67%>(Optional) This switch is used to enable cross-database ownership chaining. To enable cross-database ownership chaining, set this switch to <B>1</B>. For more information, see Section 5.1.11 <A HREF="#_enabling_cross45database_ownership_chain_ar5q">Cross-Database Ownership Chaining</A>. </TD>
</TR>
</TABLE><BR>

<UL type=disc>
	<LI>During an unattended installation, if Setup detects any non-writable databases or filegroups, that information is written to the Setup log and the unattended installation continues. If any of the non-writable databases listed in the Setup log are members of a replication topology, you must make those databases writable and reapply SP3 Setup to that instance of SQL Server 2000. For more information about making a database writable, see Section 3.12 <A HREF="#_applying_sp3_to_read-only_databases_or_filegroups">Applying SP3 to Read-Only Databases or Filegroups</A>. For more information about reapplying SP3, see Section 3.14 <A HREF="#_reapplying_sp3">Reapplying SP3</A>.</LI>
</UL>

<H2><A NAME="_redistributing_database_components_sp3_client_components"></A>4.2 Redistributing SP3 Data Access Components</H2>

<P>Database Components SP3 includes the self-extracting file Sqlredis.exe. When Sqlredis.exe runs, it:

<OL>
	<LI>Executes the file Mdac_typ.exe from Microsoft Data Access Components (MDAC) 2.7 Service Pack 1. This installs the MDAC 2.7 SP1 core components (if the same or newer version is not detected) and the versions of the SQL Server and Desktop Engine client connectivity components that are included with SP3. For more information, see 5.5.1 <A HREF="#_microsoft_data_access_components_9s7l">Updates to Microsoft Data Access Components</A>.<BR><BR></LI>

	<LI>Installs Microsoft Jet ODBC drivers and connectivity components.</LI>
</OL>

<P>You can redistribute the Sqlredis.exe file under the terms and conditions noted in the Redist.txt file that accompanies SP3.</P>

<H1><A NAME="_documentation_notes"></A>5.0 Documentation Notes</H1>

<P>This section covers issues that can occur in addition to new features that are available when you run SP3. These issues apply when running the service pack to upgrade from SQL Server 2000, SQL Server 2000 SP1, or SQL Server 2000 SP2. This section is not meant to be a description of all of the fixes provided in SP3. For a complete list of these fixes, see Microsoft Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=8632" target=_blank>306908</A>.</P>

<P>The Analysis Services and Meta Data Services segments in this section do not apply to Desktop-Engine-only installations.</P>

<P>Any information relevant to SQL Server 2000 Service Pack 3 that was not available in time to be included in this readme file will be published in Microsoft Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=10753" target=_blank>330022</A>. This article is available at the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>.</P>

<H2><A NAME="_database_and_desktop_engine_enhancements"></A>5.1 Database and Desktop Engine Enhancements</H2>

<P>The following enhancements apply to SQL Server 2000 instances on which Database Components SP3 is installed. They also apply to Desktop Engine instances on which Desktop Engine SP3 is installed.</P>

<H3><A NAME="_using_chinese_japanese_or_korean_characters_with_database_components sp3"></A>5.1.1 Using Chinese, Japanese, or Korean Characters with Database Components SP3</H3>

<P><I>Introduced in SP1</I></P>

<P>If you install Database Components SP3 on a server running Windows NT 4.0 or Windows 98 and later upgrade to Windows 2000, the Windows 2000 upgrade replaces certain system files. These system files are necessary for sorting Chinese, Japanese, or Korean characters. If you use Chinese, Japanese, or Korean characters in your SQL Server databases, rerun the version of Sqlredis.exe included with SP3 after you upgrade to Windows 2000. For more information about running Sqlredis.exe, see Section 4.2 <A HREF="#_redistributing_database_components_sp3_client_components">Redistributing SP3 Data Access Components</A>.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;You do not have to reapply Sqlredis.exe on client computers or on servers that do not have databases containing Chinese, Japanese, or Korean characters.</P><!--/NOTE--></P>

<H3><A NAME="_hash_teams_removed"></A>5.1.2 Hash Teams Removed</H3>

<P><I>Introduced in SP1</I></P>

<P>Hash teams have been removed. Because of certain enhancements to SQL Server 2000, hash teams no longer produce the performance benefits they offered in SQL Server 7.0. In addition, removing hash teams makes SQL Server 2000 more stable. </P>

<P>Therefore, the query optimizer no longer generates query plans using hash teams.</P>

<P>In rare cases, the removal of hash teams can cause a query to be processed more slowly. Analyze such queries to see whether creating more suitable indexes will return query performance to its previous level.</P>

<H3><A NAME="_affinity_mask_switches_added"></A>5.1.3 Affinity Mask Switches Added</H3>

<P><I>Introduced in SP1</I></P>

<P>Two affinity mask switches have been added to this service pack.</P>

<H5>Affinity Mask I/O Switch</H5>

<P>With this service pack, you can specify which CPUs are used to run threads for disk I/O operations. This switch must be used in conjunction with the <B>affinity mask</B> option. For more information, see article <A HREF="http://go.microsoft.com/fwlink/?LinkId=9329" target=_blank>298402</A> in the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>. For instructions on searching the Knowledge Base, see Section 1.3 <A HREF="#_additional_information_about_sp3">Additional Information About SP3</A>.</P>

<H5>Affinity Mask Connection Switch</H5>

<P>With this service pack, you can configure systems that are enabled for Virtual Interface Architecture (VIA) to bind the SQL Server connections from certain network cards to a processor or a set of processors. This switch must be used in conjunction with the <B>affinity mask</B> option. For more information, see article <A HREF="http://go.microsoft.com/fwlink/?LinkId=9330" target=_blank>299641</A> in the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>. </P>

<H3><A NAME="_filtered_indexed_view"></A>5.1.4 Filtered Indexed View</H3>

<P><I>Introduced in SP2</I></P>

<P>If you have encountered SQL Server 2000 bug 355069 as documented in Microsoft Knowledge Base Article <A HREF="http://go.microsoft.com/fwlink/?LinkId=9331" target=_blank>306467</A>, this service pack will only prevent future occurrences of unexpected results because of data modifications. In addition to applying this fix, all indexes that are based on views with filter conditions must be re-created. For more information, see the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>. </P>

<H3><A NAME="_full-text_catalogs_will_be_rebuilt_after_setup_completes"></A>5.1.5 Full-Text Catalogs Are Rebuilt After Setup Completes</H3>

<P><I>Introduced in SP3</I></P>

<P>All full-text catalogs are rebuilt as part of the installation of SP3. The rebuild is automatic and resource-intensive. Queries against full-text catalogs may return partial results or no results until the rebuild process is complete. After SP3 is installed, the system event logs contain messages stating that the catalogs were corrupt, of an older version, and had to be rebuilt. </P>

<P>For information , see the Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=11588" target=_blank>327217</A>, which also discusses possible workarounds for keeping full-text search available during the rebuild process and to avoid an automatic rebuild. </P>

<H3><A NAME="_syntax_changes_for_sp_change_users_login_wluf"></A>5.1.6 Syntax Changes for sp_change_users_login </H3>

<P><I>Introduced in SP3</I></P>

<P>When you run <B>sp_change_users_login</B> with the <B>@Action=Auto_Fix</B> argument, you must now specify a password. <B>sp_change_users_login</B> assigns the password to any new login it creates for the user. The following example shows the new <B>@Password</B> argument:</P>

<PRE><CODE>sp_change_users_login [ @Action = ] 'action' 
    [ , [ @UserNamePattern = ] 'user' ] 
    [ , [ @LoginName = ] 'login' ]
    [ , [ @Password = ] 'password' ]</CODE></PRE>

<P>Use the <B>@Password</B> argument only with <B>@Action=Auto_Fix</B>. The following example shows the new syntax for the <B>sp_change_users_login</B> command when using <B>Auto_Fix</B>. Other examples in SQL Server Books Online remain unchanged.</P>

<PRE><CODE>USE pubs
go
EXEC sp_change_users_login 'Auto_Fix', 'Mary', NULL, 'B3r12-36'
go</CODE></PRE>

<H3><A NAME="_ad_hoc_access_to_ole_db_providers_disabl_fzpy"></A>5.1.7 Ad Hoc Access to OLE DB Providers Disabled by Default</H3>

<P><I>Introduced in SP3</I></P>

<P>If the <B>DisallowAdhocAccess</B> registry option is not explicitly set, by default, ad hoc access to OLE DB providers is not allowed. This means ad hoc query syntax, such as OPENDATASOURCE and OPENROWSET, will not work against remote servers. To allow ad hoc access, you must explicitly set the <B>DisallowAdhocAccess</B> option to <B>0</B>.</P>

<H3><A NAME="_new_sqlserverlike_provider_option_cuy1"></A>5.1.8 New SqlServerLike Provider Option</H3>

<P><I>Introduced in SP3</I></P>

<P>To enable more efficient processing of remote queries that include LIKE predicates, the <B>SqlServerLike</B> option was added in SP3. If this option is set to <B>1</B>, SQL Server can push queries with LIKE predicates to the provider. Previously, if the provider was not the SQL Server OLE DB Provider, distributed queries that contained LIKE predicates were always evaluated at the local instance of SQL Server.</P>

<H3><A NAME="_expanded_error_messages_for_distributed__d3jb"></A>5.1.9 Expanded Error Messages for Distributed Queries</H3>

<P><I>Introduced in SP3</I></P>

<P>For distributed queries, SQL Server returns provider error information in addition to server error information. When a query between linked servers results in an error, SQL Server checks to see if the provider supports the <B>IErrorRecords</B> OLE DB interface. If this interface is supported, SQL Server calls the <B>GetErrorInfo</B> function to get additional error information from the provider and returns this information to the user as part of the error message. If the <B>IErrorRecords</B> interface is not supported, there is no change in SQL Server behavior: SQL Server returns a generic error.</P>

<P>For example, run the following query against a server that uses MSDASQL, which does not support <B>sql_variant</B>:</P>

<PRE><CODE>SELECT * FROM remote2k.dqtable.dbo.sqlvariantnotnull  --Remote2k is a loopback server.</CODE></PRE>

<P>Prior to SP3, SQL Server returned the following error message:</P>

<PRE><CODE>Server: Msg 7356, Level 16, State 1, Line 1
OLE DB provider 'msdasql' supplied inconsistent metadata for a column. 
Metadata information was changed at execution time.</CODE></PRE>

<P>After you apply SP3, SQL Server returns the following error message:</P>

<PRE><CODE>Server: Msg 7356, Level 16, State 1, Line 1
OLE DB provider 'msdasql' supplied inconsistent metadata for a column. 
Metadata information was changed at execution time.
OLE DB error trace [Non-interface error:  Column 'sql_variant' (compile-time
ordinal 3) of object '"dqtable"."dbo"."sqlvariantnotnull"' was reported 
to have a DBCOLUMNFLAGS_ISFIXEDLENGTH of 16 at compile time and 0 at run time].</CODE></PRE>

<H3><A NAME="_new_function_fn_get_sql_returns_sql_stat_wluf"></A>5.1.10 New Function fn_get_sql Returns SQL Statement</H3>

<P><I>Introduced in SP3</I></P>

<P>SP3 includes the new function <B>fn_get_sql</B> that returns the text of the SQL statement for the specified SQL handle. In addition, to support this function, three new columns have been added to the <B>sysprocesses</B> system table, which are listed in the following table.</P>

<TABLE border=1 cellpadding=2 cols=3 frame=box rules=rows width=587>

<TR VALIGN="top">
<TH class=label width=24%>Column name</TH>
<TH class=label width=24%>Data type</TH>
<TH class=label width=52%>Description</TH>
</TR>

<TR VALIGN="top">
<TD width=24%><B>sql_handle</B></TD>
<TD width=24%><B>binary(20)</B></TD>
<TD width=52%>Represents the currently executing batch or object.</TD>
</TR>

<TR VALIGN="top">
<TD width=24%><B>stmt_start</B></TD>
<TD width=24%><B>int</B></TD>
<TD width=52%>Starting offset of the current SQL statement for the specified <B>sql_handle</B>.</TD>
</TR>

<TR VALIGN="top">
<TD width=24%><B>stmt_end</B></TD>
<TD width=24%><B>int</B></TD>
<TD width=52%>Ending offset of the current SQL statement for the specified <B>sql_handle</B>. 
<P>A value of <B>-1</B> indicates that the current statement runs to the end of the results returned by the <B>fn_get_sq</B>l function for the specified <B>sql_handle</B>.</P>
</TD>
</TR>
</TABLE><BR>

<H5>Syntax</H5>

<P>fn_get_sql <B>(</B>[<B> @SqlHandle</B> <B>=</B> ]<I> SqlHandle </I><B>)</B></P>

<H5>Arguments</H5>

<P class=dt>[ <B>@SqlHandle</B> <B>=</B> ]<I> SqlHandle</I></P>

<P class=indent>The handle value. <I>SqlHandle </I>is <B>binary(20)</B>.</P>

<H5>Tables Returned</H5>

<TABLE border=1 cellpadding=2 cols=3 frame=box rules=rows width=595>

<TR VALIGN="top">
<TH class=label width=21%>Column name</TH>
<TH class=label width=18%>Data type</TH>
<TH class=label width=61%>Description</TH>
</TR>

<TR VALIGN="top">
<TD width=21%><B>dbid</B></TD>
<TD width=18%><B>smallint</B></TD>
<TD width=61%>Database ID. This value is <B>NULL</B> for ad hoc SQL statements.</TD>
</TR>

<TR VALIGN="top">
<TD width=21%><B>objectid</B></TD>
<TD width=18%><B>Int</B></TD>
<TD width=61%>ID of the database object. This value is <B>NULL</B> for ad hoc SQL statements.</TD>
</TR>

<TR VALIGN="top">
<TD width=21%><B>number</B></TD>
<TD width=18%><B>smallint</B></TD>
<TD width=61%>The number of the group, if the procedures are grouped. This value is <B>0</B> for entries that are not procedures and <B>NULL</B> for ad hoc SQL statements.</TD>
</TR>

<TR VALIGN="top">
<TD width=21%><B>encrypted</B></TD>
<TD width=18%><B>Bit</B></TD>
<TD width=61%>Indicates whether the object is encrypted. The value is <B>0</B> if the object is not encrypted and <B>1</B> if the object is encrypted.</TD>
</TR>

<TR VALIGN="top">
<TD width=21%><B>text</B></TD>
<TD width=18%><B>Text</B></TD>
<TD width=61%>Text of the SQL statement. This value is <B>NULL</B> for encrypted objects.</TD>
</TR>
</TABLE><BR>

<H5>Remarks</H5>

<P>You can get a valid SQL handle from the <B>sql_handle </B>column of the <B>sysprocesses </B>system table.</P>

<P>If you pass a handle that no longer exists in cache, <B>fn_get_sql</B> returns an empty result set. If you pass a handle that is not valid, the batch stops, and the following error message is returned:</P>

<P><CODE>Server: Msg 569, Level 16, State 1, Procedure fn_get_sql, Line 12 The handle passed to fn_get_sql was invalid. </CODE></P>

<P>SQL Server 2000 cannot cache some Transact-SQL statements, such as bulk copy statements and statements with string literals larger than 8 KB. You cannot retrieve handles to those statements by using the <B>fn_get_sql</B> function.</P>

<P>The <B>text </B>column of the result set is filtered for text that may contain passwords. </P>

<P>The information returned by the <B>fn_get_sql</B> function is similar to the DBCC INPUTBUFFER command. Use the <B>fn_get_sql</B> function when the DBCC INPUTBUFFER cannot be used, for example:

<UL type=disc>
	<LI>When events have more than 255 characters.<BR><BR></LI>

	<LI>When you have to return the highest current nesting level of a stored procedure. For example, there are two stored procedures that are named <B>sp_1 </B>and <B>sp_2</B>. If <B>sp_1 </B>calls <B>sp_2</B> and you get the handle from the <B>sysprocesses </B>system table while <B>sp_2 </B>is running, the fn_get_sql function returns information about <B>sp_2</B>. Additionally, the fn_get_sql function returns the complete text of the stored procedure at the highest current nesting level.</LI>
</UL>

<H5>Permissions</H5>

<P>Only members of the <B>sysadmin </B>fixed server role can run the <B>fn_get_sql</B> function. </P>

<H5>Examples</H5>

<P>Database administrators can use the <B>fn_get_sql</B> function to help diagnose problem processes. After an administrator identifies a problem server process ID (SPID), the administrator can retrieve the SQL handle for that SPID, call the <B>fn_get_sql</B> function with the handle, and use the start and end offsets to determine the SQL text of the problem SPID. For example: </P>

<PRE><CODE>DECLARE @Handle binary(20)
SELECT @Handle = sql_handle FROM sysprocesses WHERE spid = 52
SELECT * FROM ::fn_get_sql(@Handle) </CODE></PRE>

<H3><A NAME="_enabling_cross45database_ownership_chain_ar5q"></A>5.1.11 Cross-Database Ownership Chaining</H3>

<P><I>Introduced in SP3</I></P>

<P>This service pack provides new options for turning cross-database ownership chaining on and off. During Setup, the <B>Backward Compatibility Checklist</B> dialog displays an option for configuring cross-database ownership chaining. By default, Setup turns off cross-database ownership chaining for all user databases. You can enable cross-database ownership chaining for all databases. For more information, see <A HREF="#_backward_compatibility_checklist_dialog__238p"><B>Backward Compatibility Checklist</B> dialog box</A> </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Enabling cross-database ownership chaining for all databases is not recommended.</P><!--/NOTE--></P>

<P>After installation, you can use the following methods to turn cross-database ownership chaining on and off for all databases in the instance:

<UL type=disc>
	<LI>Use the new <B>Cross DB Ownership Chaining</B> argument of the <B>sp_configure</B> system stored procedure.<BR><BR></LI>

	<LI>Use the <B>Allow Cross-Database Ownership Chaining</B> option on the <B>Security</B> tab of the <B>SQL Server Properties</B> dialog box in Enterprise Manager.<BR><BR></LI>

	<LI>Use the <B>SQLServer.Configuration.ConfigValues</B> Database Management Objects (DMO) collection. When the <B>SQLServer </B>object references an instance of SQL Server 2000 SP3 or later, this collection contains a <B>ConfigValue</B> object named <B>Cross DB Ownership Chaining</B>.</LI>
</UL>

<P>If cross-database ownership chaining is turned off for the instance, you can configure it for individual databases. Use the following methods to turn cross-database ownership chaining on and off for a database:

<UL type=disc>
	<LI>Use the new <B>db chaining </B>option of the <B>sp_dboption</B> system stored procedure.<BR><BR></LI>

	<LI>Use the <B>Allow Cross-Database Ownership Chaining</B> option on the <B>Options</B> tab of the <B>Database Properties</B> dialog box in Enterprise Manager.<BR><BR></LI>

	<LI>Use the <B>DBChaining</B> property of the <B>DBOption2</B> DMO object.</LI>
</UL>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If you previously enabled cross-database ownership chaining on a pre-release version of SP3 (earlier than build 8.00.760), you must enable it again after installing the release version of SP3.</P><!--/NOTE--></P>

<P>For more information, click the Help button on the <B>Backwards Compatibility</B> <B>Checklist</B> page when you run Setup, download the updated edition of <A HREF="#_updated_books_online_documentation_is_av_wluf">SQL Server 2000 Books Online</A>, or see Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=12228" target=_blank>810474</A>.</P>

<H3><A NAME="_enhancements_for_trace_flag_1204_gq59"></A>5.1.12 Enhancement for Trace Flag 1204</H3>

<P><I>Introduced in SP3</I></P>

<P>Trace flag 1204 returns the type of locks participating in the deadlock and the current command affected. In SP3 and later, when this trace flag is on, the deadlock information is automatically written to the error log.</P>

<H3><A NAME="_permissions_change_for_sp_changedbowner_2y0t"></A>5.1.13 Permissions Change for sp_changedbowner</H3>

<P><I>Introduced in SP3</I></P>

<P>Only members of the <B>sysadmin</B> fixed server role can run the <B>sp_changedbowner</B> system stored procedure.</P>

<H3><A NAME="_debugging_functionality_changes_f8s1"></A>5.1.14 Debugging Functionality Changes</H3>

<P><I>Introduced in SP3</I></P>

<P>The functionality for debugging stored procedures with Microsoft Visual Studio&reg; 6.0 and older or with SQL Server Query Analyzer prior to SP3 is turned off by default. Application debugging (stopping at a SQL Server Transact-SQL breakpoint while debugging a client application) is also turned off by default. To enable debugging functionality, run <B>sp_sdidebug</B>, passing the parameter <B>legacy_on</B>. To disable debugging, pass <B>legacy_off </B>to this procedure. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Running the <B>sp_sdidebug</B> stored procedure on production servers is not recommended.</P><!--/NOTE--></P>

<P>For more information, see Microsoft Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=11714" target=_blank>328151</A>. This article is available at the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>.</P>

<H2><A NAME="_analysis_services_enhancements"></A>5.2 Analysis Services Enhancements</H2>

<P>This section discusses enhancements to SQL Sever 2000 Analysis Services that are included with SP3.</P>

<H3><A NAME="_remote_partitions"></A>5.2.1 Remote Partitions</H3>

<P><I>Introduced in SP1</I></P>

<P>When a remote partition is created on a local server that has SP1 or a later version installed on it, the remote server must use a domain user account that has full access permissions to the parent cube on the local server. Any user account that is a member of the OLAP Administrators group on the local server has full access permissions. </P>

<P>In addition, if the local server has SP1 or a later version installed on it, the remote server also must have SP1 or a later version installed on it so that the local server can create or administer remote partitions.</P>

<H3><A NAME="_updated_analysis_services_redistributable_client_setup"></A>5.2.2 Updated Analysis Services Redistributable Client Setup</H3>

<P><I>Introduced in SP1</I></P>

<P>Analysis Services SP1 and later versions include updated versions of the following client redistributable setup programs:

<UL type=disc>
	<LI>PTSLite.exe<BR><BR></LI>

	<LI>PTSFull.exe</LI>
</UL>

<P>These files are located in the \Msolap\Install\PTS path of the SP3 installation directory.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;PTSFull.exe includes MDAC; PTSLite.exe does not.</P><!--/NOTE--></P>

<P>Use these updated client setup programs in your applications to prevent or solve client setup issues that you may encounter when using Analysis Services and Microsoft Office XP. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;When using Analysis Services with Office XP, upgrading the client is highly recommended.</P><!--/NOTE--></P>

<H3><A NAME="_support_enabled_for_third_party_data_mining_algorithm_providers"></A>5.2.3 Support Enabled for Third-Party Data Mining Algorithm Providers</H3>

<P><I>Introduced in SP1</I></P>

<P>Analysis Services SP1 and later versions include support for the addition of third-party data mining algorithm providers. For more information about developing a data mining algorithm provider, see the <A href="http://go.microsoft.com/fwlink/?linkid=9333" target=_blank>"Third Party Data Mining Providers"</A> white paper and the <A href="http://go.microsoft.com/fwlink/?linkid=9332" target=_blank><I>OLE DB for Data Mining Resource Kit</I></A>, which includes the code for a sample data mining algorithm provider.</P>

<H3><A NAME="_installing_analysis_services_on_a_computer_with_updated_client_files"></A>5.2.4 Installing Analysis Services on a Computer with Updated Client Files</H3>

<P><I>Introduced in SP1</I></P>

<P>If you install SQL Server 2000 Analysis Services on a computer that contains updated client files, such as SQL Server 2000 SP1 or Office XP, you must apply Analysis Services SP1 or a later version to ensure that the client works properly and that you can browse through cubes.</P>

<H3><A NAME="_increased_limit_for_olap_cubes_reference_wluf"></A>5.2.5 Increased Limit for OLAP Cubes Referenced by a Virtual Cube</H3>

<P><I>Introduced in SP3</I></P>

<P>Virtual cubes can now reference up to 255 cubes. However, any virtual cube that references more than 64 cubes is not visible to any version of Microsoft PivotTable&reg; Service released before SP3.</P>

<H3><A NAME="_new_description_keyword_fzpy"></A>5.2.6 New DESCRIPTION Keyword</H3>

<P><I>Introduced in SP3</I></P>

<P>Local cubes now support the intrinsic member property DESCRIPTION for measures and dimensions. The DESCRIPTION keyword, added to the CREATE CUBE Multidimensional Expressions (MDX) statement, is used to support the use of the DESCRIPTION intrinsic member property. The following BNF clauses describe the changes made to the CREATE CUBE statement:</P>

<PRE><CODE>&lt;dimensions def&gt; :: = DIMENSION &lt;dimension name&gt; [&lt;time def&gt;] 
[DIMENSION_STRUCTURE &lt;sub_type&gt;] [&lt;hidden def&gt;] [DESCRIPTION &lt;description expression&gt;] 
&lt;options def&gt; &lt;comma&gt; &lt;hierarchy def list&gt; 
&lt;measures def&gt; :: = MEASURE &lt;measure name&gt; &lt;measure function def&gt; 
[&lt;measure format def&gt;] [&lt;measure type def&gt;] [&lt;hidden def&gt;] [DESCRIPTION &lt;description expression&gt;] 
[&lt;comma&gt; &lt;measures def&gt;]</CODE></PRE>

<H3><A NAME="_new_pivot_table_service_restricted_clien_cuy1"></A>5.2.7 New PivotTable Service Restricted Client Property</H3>

<P><I>Introduced in SP3</I></P>

<P>SP3 implements a new PivotTable Service connection string property, <B>Restricted Client</B>. This property can be used to restrict PivotTable Service from using local cube functionality. Any attempt to use a statement that involves the creation or use of a local cube, such as the CREATE CUBE, CREATE GLOBAL CUBE, and CREATE SESSION CUBE statements, raises an error. Additionally, any statement that involves deep recursion, such as a series of nested DRILLDOWN statements, raises an error if the statement can potentially overflow the statement stack maintained by PivotTable Service. </P>

<P>This property stores a string value. If the value is set to any string value starting with the characters "Y", "y", "T", or "t", or any string value that can be converted to a numeric value other than 0, PivotTable Service is restricted as described earlier. If the value is set to any other string value, including an empty string (""), or any string value that can be converted to a numeric value equal to 0, PivotTable Service is unrestricted. The default value for this property is "0".</P>

<P><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;This property does not restrict the use of local data mining models.</P><!--/NOTE--></P>

<H3><A NAME="_change_to_the_safety_options_property_0a8g"></A>5.2.8 Change in the Safety Options Property</H3>

<P><I>Introduced in SP3</I></P>

<P>Setting the <B>Safety Options</B> property to DBPROP_MSMD_SAFETY_OPTIONS_ALLOW_SAFE also prevents usage of the PASSTHROUGH keyword in local cubes.</P>

<H3><A NAME="_migrate_repository_to_meta_data_services_d3jb"></A>5.2.9 Migrate Repository to Meta Data Services Disabled by Default</H3>

<P><I>Introduced in SP3</I></P>

<P>The option to use the Meta Data Services repository format in the Migrate Repository Wizard has been disabled in SP3, and using this format is not recommended. However, if this format is required for business reasons, you can enable the option through the <B>EnableMigrationToMetaDataServicesFormat</B> registry key. </P>

<P>By default, this registry key does not exist; it must be manually created at <B>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\OLAP Server\Server Connection Info</B> and set to enable repository migration to the Meta Data Services format. This registry key stores a case-sensitive string value. If the value is set to <B>1</B> or <B>True</B>, repository migration to the Meta Data Services format is enabled. If the value is set to any other string value, or if the registry key does not exist, repository migration to the Meta Data Services format is disabled. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If the value of this registry key is changed, the change takes effect immediately.</P><!--/NOTE--></P>

<H3><A NAME="_permissions_must_be_modified_on_a_remote_d3jb"></A>5.2.10 Permissions Must be Modified on a Remote Data Folder</H3>

<P><I>Introduced in SP3</I></P>

<P>If the Analysis Services Data folder is located on a computer other than the one on which the Analysis server is running, you must modify the permissions on the folder after running SP 3 Setup. Set the permissions on the folder to allow full control access by all members of the <B>OLAP Administrators</B> group on the computer running the Analysis server. Over time, as members are added to or removed from the <B>OLAP Administrators</B> group, be sure to modify the permissions on the remote Data folder to so that it reflects the current membership of the <B>OLAP Administrators</B> group. This will allow backup and restore to function properly.</P>

<P>Additionally, after running SP3 Setup, you must allow the account under which the Analysis server is running full control access to the remote Data folder. </P>

<P>If you apply SP3 to an instance of Analysis Services running in a clustered configuration, the domain-level <B>OLAP Administrators</B> group must be allowed full control access to the remote Data folder. For more information about creating and using a domain-level <B>OLAP Administrators</B> group, see support article <A HREF="http://go.microsoft.com/fwlink/?LinkId=12243" target=_blank>308023</A> available at the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>.</P>

<H2><A NAME="_replication_enhancements"></A>5.3 Replication Enhancements</H2>

<P>This section discusses enhancements to SQL Sever 2000 replication that are included with SP3.</P>

<H3><A NAME="_transactional_replication_update_custom_stored_procedure"></A>5.3.1 Transactional Replication UPDATE Custom Stored Procedure</H3>

<P><I>Introduced in SP1</I></P>

<P>During transactional replication setup, custom stored procedures for insert, delete, and update actions are created in the subscription database. Regardless of how many columns are affected by an UPDATE statement, the update custom stored procedure updates all of the columns in the subscription table. Any column that has not changed is reset to the same values that existed before the update. Typically, this action causes no problems. However, if any of these columns are indexed, this resetting can become expensive.</P>

<P>If you use transactional replication and have several indexes on the subscription table, and only a few column values change because of updates, the overhead of maintaining the index can limit performance when changes are applied at the Subscriber. For example, a subscription database that is used for reporting purposes may have many more indexes than the publication database. Dynamically building the UPDATE statement at run time can improve performance. The update includes only the columns that have changed, creating an optimal UPDATE string. </P>

<P>This service pack includes a new stored procedure, <B>sp_scriptdynamicupdproc</B>, which generates a custom stored procedure that you can use at the Subscriber to dynamically build the UPDATE statement at run time. However, building the dynamic UPDATE statement at run time requires extra processing.</P>

<H4>sp_scriptdynamicupdproc</H4>

<P>The stored procedure <B>sp_scriptdynamicupdproc</B> generates the CREATE PROCEDURE statement that creates a dynamic update stored procedure. The UPDATE statement within the custom stored procedure is built dynamically, based on the MCALL syntax that indicates which columns to change. Use this stored procedure if the number of indexes on the subscribing table is growing and the number of columns being changed is small. This stored procedure is run at the Publisher on the publication database.</P>

<H5>Syntax</H5>

<P>sp_scriptdynamicupdproc [ <B>@artid</B> =] <I>artid</I></P>

<H5>Arguments</H5>

<P>[<B>@artid</B> <B>=</B>] <I>artid</I></P>

<P>The article ID. <I>artid</I> is an <B>int</B>, with no default.</P>

<H5>Result Sets</H5>

<P>Returns a result set that consists of a single <B>nvarchar(4000)</B> column. The result set forms the complete CREATE PROCEDURE statement that is used to create the custom stored procedure.</P>

<H5>Remarks</H5>

<P><B>sp_scriptdynamicupdproc</B> is used in transactional replication. The default MCALL scripting logic includes all columns within the UPDATE statement and uses a bitmap to determine the columns that have changed. If a column did not change, the column is set back to itself, which usually causes no problems. If the column is indexed, extra processing occurs. By contrast, this stored procedure uses a dynamic approach: it includes only the columns that have changed, which provides an optimal UPDATE string. However, extra processing is incurred at run time when the dynamic UPDATE statement is built. It is recommended that you test both the dynamic stored procedure approach and the static default approach, and then choose the optimal solution for your particular needs.</P>

<H5>Permissions</H5>

<P>Members of the <B>public</B> role can execute <B>sp_scriptdynamicupdproc</B>.</P>

<H5>Examples</H5>

<P>This example creates an article (with <I>artid</I> set to <B>1</B>) on the <B>authors</B> table in the <B>pubs</B> database, and specifies that the UPDATE statement is the custom stored procedure to execute:</P>

<PRE><CODE>'MCALL sp_mupd_authors'
</CODE></PRE>

<P>Generate the custom stored procedures to be executed by the Distribution Agent at the Subscriber by running the following stored procedure at the Publisher:</P>

<PRE><CODE>EXEC sp_scriptdynamicupdproc @artid = '1'
The statement returns:

create procedure [sp_mupd_authors] 
  @c1 varchar(11),@c2 varchar(40),@c3 varchar(20),@c4 char(12),@c5 varchar(40),@c6 varchar(20),
  @c7 char(2),@c8 char(5),@c9 bit,@pkc1 varchar(11),@bitmap binary(2)
as

declare @stmt nvarchar(4000), @spacer nvarchar(1)
select @spacer =N''
select @stmt = N'update [authors] set '

if substring(@bitmap,1,1) &amp; 2 = 2
begin
  select @stmt = @stmt + @spacer + N'[au_lname]' + N'=@2'
  select @spacer = N','
end
if substring(@bitmap,1,1) &amp; 4 = 4
begin
  select @stmt = @stmt + @spacer + N'[au_fname]' + N'=@3'
  select @spacer = N','
end
if substring(@bitmap,1,1) &amp; 8 = 8
begin
  select @stmt = @stmt + @spacer + N'[phone]' + N'=@4'
  select @spacer = N','
end
if substring(@bitmap,1,1) &amp; 16 = 16
begin
  select @stmt = @stmt + @spacer + N'[address]' + N'=@5'
  select @spacer = N','
end
if substring(@bitmap,1,1) &amp; 32 = 32
begin
  select @stmt = @stmt + @spacer + N'[city]' + N'=@6'
  select @spacer = N','
end
if substring(@bitmap,1,1) &amp; 64 = 64
begin
  select @stmt = @stmt + @spacer + N'[state]' + N'=@7'
  select @spacer = N','
end
if substring(@bitmap,1,1) &amp; 128 = 128
begin
  select @stmt = @stmt + @spacer + N'[zip]' + N'=@8'
  select @spacer = N','
end
if substring(@bitmap,2,1) &amp; 1 = 1
begin
  select @stmt = @stmt + @spacer + N'[contract]' + N'=@9'
  select @spacer = N','
end
select @stmt = @stmt + N' where [au_id] = @1'
exec sp_executesql @stmt, N' @1 varchar(11),@2 varchar(40),@3 varchar(20),@4 char(12),@5 varchar(40),
                             @6 varchar(20),@7 char(2),@8 char(5),@9 bit',@pkc1,@c2,@c3,@c4,@c5,@c6,@c7,@c8,@c9

if @@rowcount = 0
   if @@microsoftversion&gt;0x07320000
      exec sp_MSreplraiserror 20598
</CODE></PRE>

<P>After running this stored procedure, you can use the resulting script to manually create the stored procedure at the Subscribers.</P>

<H3><A NAME="_transactional_replication_update_statements_on_unique_columns"></A>5.3.2 Transactional Replication UPDATE Statements on Unique Columns</H3>

<P><I>Introduced in SP1</I></P>

<P>In transactional replication, UPDATE statements usually are replicated as updates. But if the update changes any column that is part of a unique index, a clustered index, or an expression that is used as a unique constraint, the update is performed as a DELETE statement followed by an INSERT statement at the Subscriber. This is done because this type of update can affect multiple rows and a uniqueness violation can occur if updates are delivered row by row. </P>

<P>If the update affects only one row, there is no chance for a uniqueness violation. Therefore, trace flag 8207 has been added to this service pack to allow updates to any unique column that affect only one row to be replicated as UPDATE statements. This optimization has been added specifically for applications that install user-defined UPDATE triggers at the Subscriber and require these triggers to fire for updates that affect only one row on a unique column.</P>

<P>To use trace flag 8207, turn it on from the command prompt (sqlservr.exe -<B>T8207</B>) or at run time using DBCC TRACEON(8207, -1) before the Log Reader Agent is started.</P>

<P class=indent><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;Typically, trace flag 8207 is used with read-only transactional replication. Do not use this trace flag with updatable subscriptions if the primary key UPDATE can occur at the Subscriber. </P><!--/IMPORTANT--></P>

<H3><A NAME="_restrictions_removed_from_concurrent_snapshot_processing"></A>5.3.3 Restrictions Removed from Concurrent Snapshot Processing</H3>

<P><I>Introduced in SP1</I></P>

<P>In SQL Server 2000, concurrent snapshot processing was not recommended if the publishing table had a unique index that was not the primary key or the clustering key. If data modifications were made to the clustering key while a concurrent snapshot was being generated, replication could fail with a duplicate key error when applying the concurrent snapshot to a Subscriber. With this service pack, restrictions on using concurrent snapshot processing are removed.</P>

<H3><A NAME="_transactional_replication_scripting_custom_stored_procedures"></A>5.3.4 Transactional Replication Scripting Custom Stored Procedures</H3>

<P><I>Introduced in SP1</I></P>

<P>When setting up nosync subscriptions (that is, subscriptions that do not receive the initial snapshot), the custom stored procedures for INSERT, UPDATE, and DELETE statements must be created manually. Typically, these statements are created at the Subscriber when the initial snapshot is delivered. A new stored procedure, <B>sp_scriptpublicationcustomprocs</B>, has been added to generate scripts for the custom stored procedures at the publication level. This new functionality may make it easier to set up nosync subscriptions.</P>

<H4>sp_scriptpublicationcustomprocs</H4>

<P>In a publication in which the option to auto-generate a custom procedure schema is enabled, the stored procedure <B>sp_scriptpublicationcustomprocs</B> scripts the custom INSERT, UPDATE, and DELETE procedures for all table articles. <B>sp_scriptpublicationcustomprocs</B> is particularly useful for setting up subscriptions for which the snapshot is applied manually.</P>

<H5>Syntax</H5>

<P><B>sp_scriptpublicationcustomprocs</B> [<B>@publication</B>]= <I>publication_name</I></P>

<H5>Arguments</H5>

<P class=dt>[<B>@publication</B>]<CODE> = </CODE><I>publication_name</I></P>

<P class=indent>The name of the publication. <I>publication_name</I> is a <B>sysname</B> with no default.</P>

<H5>Return Code Values</H5>

<P>0 (success) or 1 (failure)</P>

<H5>Result Sets</H5>

<P>Returns a result set that consists of a single <B>nvarchar(4000)</B> column. The result set forms the complete CREATE PROCEDURE statement that is necessary to create the custom stored procedure.</P>

<H5>Remarks</H5>

<P>Custom procedures are not scripted for articles without the auto-generate custom procedure (0x2) schema option.</P>

<H5>Permissions</H5>

<P>Execute permission is granted to <B>public</B>; a procedural security check is performed inside this stored procedure to restrict access to members of the <B>sysadmin</B> fixed server role and <B>db_owner</B> fixed database role in current database.</P>

<H5>Example</H5>

<P>This example generates a script of the custom stored procedures in a publication named <B>Northwind</B>.</P>

<PRE><CODE>exec Northwind.dbo.sp_scriptpublicationcustomprocs 
@publication = N'Northwind'
</CODE></PRE>

<H3><A NAME="_merge_replication_retention-based_meta_data_clean_up"></A>5.3.5 Merge Replication Retention-Based Meta Data Clean Up</H3>

<P><I>Introduced in SP1</I></P>

<P>When merge replication system tables contain large amounts of meta data, cleaning up the meta data improves performance. Prior to SQL Server 2000 SP1, meta data could be cleaned up only by running <B>sp_mergecleanupmetadata</B>. However, SQL Server 2000 SP1 and later versions include retention-based meta data clean up, which means that meta data can be automatically deleted from the following system tables: 

<UL type=disc>
	<LI><B>MSmerge_contents</B><BR><BR></LI>

	<LI><B>MSmerge_tombstone</B><BR><BR></LI>

	<LI><B>MSmerge_genhistory</B><BR><BR></LI>

	<LI>Any before image tables, if present</LI>
</UL>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Before image<I> </I>tables are present if the <B>@keep_partition_changes</B> synchronization optimization option is enabled on the publication.</P><!--/NOTE--></P>

<P>Retention-based meta data clean up occurs as follows:

<UL type=disc>
	<LI>If the <B>&#0150;MetadataRetentionCleanup</B> Merge Agent parameter is set to 1, as it is by default, the Merge Agent cleans up the Subscriber and the Publisher that are involved in the merge. <BR><BR></LI>

	<LI>If the <B>-MetadataRetentionCleanup</B> parameter is set to 0, automatic clean up does not occur. In this case, manually initiate retention-based meta data clean up by executing <B>sp_mergemetadataretentioncleanup</B>. This stored procedure must be executed at every Publisher and Subscriber that should be cleaned up. It is recommended, but not required, that the Publisher and Subscribers be cleaned up at similar points in time (see <A HREF="#_preventing_false_conflicts">Preventing False Conflicts</A> later in this section).
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;The <B>-MetadataRetentionCleanup</B> parameter is set to <B>1</B> for all Merge Agent profiles that are included with SQL Server 2000 SP1 and later versions. If you upgrade a server to SP1 or later and then add merge replication, the Merge Agent profile is automatically updated to include this parameter. If you upgrade a server that already has merge replication enabled to SP1 or SP3, the Merge Agent profile is not automatically updated; update the profile by running <B>sp_add_agent_parameter</B> (see <A HREF="#_additional_parameter_for_sp_add_agent_parameter">Additional Parameter for sp_add_agent_parameter</A> later in this section).</P><!--/NOTE--></p>
<P class=atl><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;The default retention period for publications is 14 days. If an article belongs to several publications, there might be different retention periods. In that situation, the longest retention period is used to determine the earliest possible time that clean up can occur. If there are multiple publications on a database, and if any one of those publications uses an infinite publication retention period (<B>@retention=0</B>), merge meta data for the database is not automatically cleaned up. For this reason, use infinite publication retention with caution.</P><!--/IMPORTANT--></p></LI>
</UL>

<H4><A NAME="_additional_parameter_for_sp_add_agent_parameter"></A>Additional Parameter for sp_add_agent_parameter</H4>

<P>The system stored procedure <B>sp_add_agent_parameter</B> now has a <B>MetadataRetentionCleanup</B> parameter, which allows you to add or remove meta data retention clean up from Merge Agent profiles. A value of 1 indicates that the profile should include clean up; a value of 0 indicates that it should not include clean up. For example, to add meta data retention clean up to a profile, execute the following code:</P>

<PRE><CODE>EXEC sp_add_agent_parameter @profile_id=&lt;my_profile_id&gt;, @parameter_name='MetadataRetentionCleanup', @parameter_value=1</CODE></PRE>

<H4>Meta Data Cleanup in Topologies with Different Versions of SQL Server</H4>

<P>For automatic retention-based clean up to occur in a database involved in merge replication, the database and the Merge Agent must both be on servers running SQL Server 2000 SP1 or later. For example:

<UL type=disc>
	<LI>A SQL Server 7.0 pull Subscriber does not run clean up at a SQL Server 2000 SP1 Publisher.<BR><BR></LI>

	<LI>A SQL Server 2000 SP1 push Merge Agent does not run clean up in a pre-SP1 SQL Server 2000 Subscriber database. <BR><BR></LI>

	<LI>A SQL Server 2000 SP1 push Merge Agent runs clean up in a SQL Server 2000 SP1 Publisher database, even if it has subscribers that are running SQL Server 2000 or earlier.</LI>
</UL>

<P>Automatic clean up on some servers and not on others will at most cause false conflicts, and those should be rare. For topologies that include versions of SQL Server prior to SQL Server 2000 SP1, you may see performance benefits by running <B>sp_mergemetadatacleanup</B> on all servers that are not cleaned up automatically.</P>

<H4><A NAME="_preventing_false_conflicts"></A>Preventing False Conflicts</H4>

<P>Retention-based meta data clean up prevents non-convergence and silent overwrites of changes at other nodes. However, false conflicts can occur if the following conditions are met:

<UL type=disc>
	<LI>The meta data is cleaned up at one node and not another.<BR><BR></LI>

	<LI>A subsequent update at the cleaned-up node occurs on a row whose meta data was deleted.</LI>
</UL>

<P>For example, if meta data is cleaned up at the Publisher but not at the Subscriber, and an update is made at the Publisher, a conflict occurs even though the data appears to be synchronized. </P>

<P>To prevent this conflict, make sure that meta data is cleaned up at related nodes at about the same time. If <B>-MetadataRetentionCleanup</B> is set to 1, both the Publisher and Subscriber are cleaned up automatically before the merge starts, thereby ensuring that the nodes are cleaned up at the same time. If a conflict occurs, use the merge replication conflict viewer to review the conflict and change the outcome if necessary.</P>

<P>If an article belongs to several publications or is in a republishing scenario, it is possible that the retention periods for a given row at the Publisher and Subscriber are different. To reduce the chance of cleaning up meta data on one side but not the other, it is recommended that those different publications have similar retention periods.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If the system tables contain large amounts of meta data that must be cleaned up, the merge process may take longer to run. Clean up the meta data on a regular basis to prevent this issue.</P><!--/NOTE--></P>

<H3><A NAME="_backup_and_restore_issues_for_merge_replication"></A>5.3.6 Backup and Restore Issues for Merge Replication</H3>

<P><I>Introduced in SP1</I></P>

<P>A publication database that is restored from a backup should first synchronize with a subscription database that has a global subscription (that is, a subscription having an assigned priority value) to guarantee correct convergence behavior. Synchronization ensures that the changes that were lost at the publication database because of the restore operation are reapplied accurately.</P>

<P>Do not synchronize the publication database with a subscription database that has an anonymous subscription. Because anonymous subscriptions do not have enough meta data to apply changes to the publication database, such synchronization can lead to the non-convergence of data. </P>

<P>When you are planning back up and restore operations for merge replication, consider the following additional issues: 

<UL type=disc>
	<LI>Restore the subscription databases from backups that are not beyond the retention period.</LI>
</UL>

<P class=indent>Restore a subscription database from a backup only if the backup is no older than the shortest retention period of all publications to which the Subscriber subscribes. For example, if a Subscriber subscribes to three publications with retention periods of 10, 20, and 30 days, respectively, the backup used to restore the database should not be more than 10 days old. 

<UL type=disc>
	<LI>Synchronize before generating a backup.</LI>
</UL>

<P class=indent>It is strongly recommended that a Subscriber synchronize with the Publisher before you perform a backup. Otherwise, the system might not converge correctly if the Subscriber is restored from this backup. Although the backup file itself might be new, the last synchronization with a Publisher could be almost as old as the retention period. For example, consider a publication with a retention period of 10 days. The last synchronization was 8 days ago, and now the backup is performed. If the backup is applied 4 days later, the last synchronization will have occurred 12 days ago, which is past the retention period. If the Subscriber had synchronized right before the backup, the subscription database would be within the retention period.

<UL type=disc>
	<LI>Reinitialize the Subscriber if you change the publication retention value.</LI>
</UL>

<P class=indent>If you need to change the publication retention value, manually reinitialize the Subscriber to avoid the non-convergence of data. The retention-based meta data clean up feature deletes outdated meta data from merge system tables when the publication retention period is reached. </P>

<P class=indent>The publication retention value is used to determine when subscriptions that have not synchronized within the retention period should expire. If, after a clean up, the publication retention period is increased and a subscription attempts to merge with the Publisher (which has already deleted the meta data), the subscription will not expire because of the increased retention value. Furthermore, the Publisher does not have enough meta data to download changes to the Subscriber, which leads to non-convergence.

<UL type=disc>
	<LI>Use the same publication retention values for all Publishers and their alternate synchronization partners. Using different values can lead to non-convergence.</LI>
</UL>

<H3><A NAME="_restoring_replicated_databases_from_different_versions_of_sql_server"></A>5.3.7 Restoring Replicated Databases from Different Versions of SQL Server</H3>

<P><I>Introduced in SP1</I></P>

<P>Restoring a backup to the same server and database&#0151;running the same version as the server from which the backup was created&#0151;preserves your replication settings. If you are restoring a replicated database to a version of SQL Server that is different from the version used to back up the database, consider the following issues:

<UL type=disc>
	<LI>If you are restoring the database to SQL Server 2000 SP3 from a backup created with SQL Server 2000 and you want to preserve replication settings, you must run <B>sp_vupgrade_replication</B>. Running <B>sp_vupgrade_replication</B> ensures that the replication meta data is upgraded. If you do not run <B>sp_vupgrade_replication</B>, the replication meta data can be left in an unpredictable state.<BR><BR></LI>

	<LI>If you are restoring the database to SQL Server 2000 from a backup created with SQL Server 7.0 (the release version, SP1, SP2, or SP3) and you want to preserve replication settings, you must re-create the backup before installing service packs. It is possible to restore the database to SQL Server 2000 SP3 directly from a backup of a replicated database created in SQL Server 7.0, but replication settings are not maintained.</LI>
</UL>

<H3><A NAME="_a_new_-maxcmdsintran_parameter_for_log_reader_agent"></A>5.3.8 New -MaxCmdsInTran Parameter for Log Reader Agent</H3>

<P><I>Introduced in SP1</I></P>

<P>Starting with SP1, a new command prompt parameter, <B>-MaxCmdsInTran</B>, has been added for the Log Reader Agent. For transactions affecting a large number of commands (typically mass updates or deletes), the Distribution Agent must wait for the Log Reader Agent to write the entire transaction to the distribution database before it can start propagating the transaction to the Subscriber. This delay blocks the Distribution Agent and reduces the parallelism between the two agents.</P>

<P>By using <B>&#0150;MaxCmdsInTran</B>, the Log Reader Agent breaks large transactions into smaller chunks, and each chunk contains the same or fewer commands as the <B>-MaxCmdsInTran</B> input. Therefore, the Distribution Agent can start processing earlier chunks of a transaction while the Log Reader Agent is still working through later chunks of the same transaction.</P>

<P>This improvement in parallelism between the Log Reader Agent and the Distribution Agent contributes to better overall replication throughput. Note, however, that the transaction chunks are committed at the Subscriber as individual transactions, which breaks the property of atomicity, one of the ACID (Atomicity, Consistency, Isolation, and Durability) properties. This outcome is not a problem in most circumstances, though it is recommended that you test this to make sure.</P>

<H5>Defining the &#0150;MaxCmdsInTran Parameter</H5>

<P>Specify a positive integer (1 or above) for the <B>-MaxCmdsInTran</B> parameter value. Specifying a value of 0 is equivalent to not using the parameter. Because this parameter improves performance only when the transaction is very large, a value of 5000 or greater for this parameter is typical. For example:</P>

<PRE><CODE>logread.exe -MaxCmdsInTran 10000. </CODE></PRE>

<P>To use this parameter, the Publisher must be running SQL Server 2000 SP1 or a later version, and the Log Reader Agent and distribution database must be upgraded to SP3. Otherwise, <B>-MaxCmdsInTran</B> is ignored.</P>

<H3><A NAME="_restriction_on_non-unique_clustered_indexes"></A>5.3.9 Restriction on Non-unique Clustered Indexes</H3>

<P><I>Introduced in SP2 (applies to Transactional Replication only).</I></P>

<P>You cannot create a non-unique clustered index on a table after it is published for transactional replication. Before creating the index you must first drop any publication that includes the table.</P>

<H3><A NAME="_a_new_-maxnetworkoptimization_command_line_argument_for_snapshot_agent"></A>5.3.10 New -MaxNetworkOptimization Command Line Argument for Snapshot Agent</H3>

<P><I>Introduced in SP2.</I></P>

<P>During normal processing, merge replication can send DELETE commands to Subscribers for rows that do not belong to the Subscriber's partition. DELETE commands of this type are referred to as irrelevant deletes. Irrelevant deletes do not affect data integrity or convergence, but they can result in unnecessary network traffic. </P>

<P>To reduce network traffic caused by irrelevant deletes, you can use the new Snapshot Agent parameter <BR>
<B>-MaxNetworkOptimization</B> with merge replication publications. Setting the parameter to 1 minimizes the chances of irrelevant deletes, which maximizes network optimization. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Setting this parameter to 1 is useful only when the synchronization optimization option of the merge publication is set to true (the <B>@keep_partition_changes</B> parameter of <B>sp_addmergepublication</B>).</P><!--/NOTE--></P>

<P>The default is 0 because setting the parameter to 1 can increase the storage of meta data and cause performance to degrade at the Publisher if multiple levels of join filters and complex subset filters are present. You should carefully assess your replication topology and set <B>-MaxNetworkOptimization</B> to 1 only if network traffic from irrelevant deletes is unacceptably high.</P>

<P>You can add this parameter to the Snapshot Agent profile by executing the system procedure <B>sp_add_agent_parameter</B> as follows:</P>

<PRE><CODE>EXEC sp_add_agent_parameter 1, 'MaxNetworkOptimization', 1</CODE></PRE>

<H3><A NAME="_merge_replication_uses_new_role_d3jb"></A>5.3.11 Merge Replication Uses New Role</H3>

<P><I>Introduced in SP3</I></P>

<P>SP3 automatically creates a new role for use by merge replication. The name of the new role is in the form <B>MSmerge-&lt;publication ID&gt;</B>. The role is created on the Publisher for each merge replication publication and acts as the publication access list (PAL) to control access to merge publications on the Publisher. If this role is dropped, you can run a new stored procedure included with SP3, <B>sp_createmergepalrole</B>, to re-create the role. This stored procedure is executed at the Publisher on the publication database to re-create the role. </P>

<H5>Syntax</H5>

<P><B>sp_createmergepalrole</B> [ <B>@publication</B> <B>= </B>] <B>'</B><I>publication</I><B>' </B></P>

<H5>Arguments</H5>

<P class=dt>[<B>@publication</B> <B>=</B> ] <B>'</B><I>publication</I><B>' </B></P>

<P class=indent>The publication name. <I>publication</I> is <B>sysname</B>, with no default. This parameter is used to select the publication to use when re-creating a role used by merge replication. </P>

<H5>Return Code Values</H5>

<P>0 (success) or 1 (failure)</P>

<H5>Remarks</H5>

<P>Running <B>sp_createmergepalrole</B> adds a new row to the <B>sysusers</B> table for the new role. The name of this new role is based on the value of the <B>pubid</B> column in the <B>sysmergepublications</B> table for the given <I>publication</I>. The prefix of the role name is 'MSMerge_' and the <B>pubid</B> value is appended (without the hyphens) to the role name.</P>

<H5>Permissions</H5>

<P>Only members of the <B>sysadmin</B> fixed server role or <B>db_owner</B> fixed database role can run <B>sp_createmergepalrole</B>.</P>

<H3><A NAME="_sql_agent_proxy_account_required_for_non_wluf"></A>5.3.12 New Requirements for Subscriptions Created by Non-sysadmin Users</H3>

<P><I>Introduced in SP3</I></P>

<P>If a subscription is created by a user who is not a member of the <B>sysadmin</B> fixed server role, you must do one of the following:

<UL type=disc>
	<LI>Configure the SQL Server Agent proxy account with a login and password so that the SQL Server Agent job step associated with the replication agent runs with sufficient privileges. For more information, see the topic "xp_sqlagent_proxy_account" in SQL Server Books Online.<BR><BR></LI>

	<LI>Change the owner of the job step to a user that is a member of the <B>sysadmin</B> fixed server role before running the agent.</LI>
</UL>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;The remote agent activation feature always requires the job step to run in the context of a user account in the <B>sysadmin</B> fixed server role.</P><!--/NOTE--></P>

<H3><A NAME="_changes_to_permissions_on_stored_procedu_d3jb"></A>5.3.13 Changes to Permissions for Stored Procedures</H3>

<P><I>Introduced in SP3</I></P>

<P>Permissions have been changed on a number of the stored procedures used to implement, administer, and monitor a replication topology. Most of these changes involve a tightening of the permissions that are required to run the stored procedures. For more information about the new permissions, review the Transact-SQL reference documentation for the replication stored procedures in the updated version of SQL Server Books Online. For more information about the updated SQL Server Books Online, see Section 1.5 <A HREF="#_updated_books_online_documentation_is_av_wluf">Updated Books Online Documentation Is Available</A>.</P>

<H3><A NAME="_new_parameter_for_sp_addmergearticle_and_fzpy"></A>5.3.14 New Parameter for sp_addmergearticle and sp_changemergearticle</H3>

<P><I>Introduced in SP3</I></P>

<P>A new parameter, <B>@published_in_tran_pub</B>, has been added to both <B>sp_addmergearticle</B> and <B>sp_changemergearticle</B>. This parameter is used to indicate that an article in a merge publication is also published in a transactional publication. <B>@published_in_tran_pub </B>is <B>nvarchar(5)</B>, with a default of <B>FALSE</B>. <B>TRUE</B> specifies that the article is also published in a transactional publication. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;When you change this parameter in <B>sp_changemergearticle</B>, the snapshot must be invalidated and subscribers must be reinitialized.</P><!--/NOTE--></P>

<H3><A NAME="_new_page_for_configure_publishing_and_di_fzpy"></A>5.3.15 New Page for Configure Publishing and Distribution Wizard</H3>

<P><I>Introduced in SP3</I></P>

<P>The Configure Publishing and Distribution Wizard now includes a new page: Distributor Password. You must type a password on this page if you select one or more Publishers to use the server as a remote Distributor and one or more of those Publishers require a password. The connection between a Publisher and a remote Distributor is a hybrid of a linked server and a remote server. The connection uses the login <B>distributor_admin</B>. By default, the Publisher is configured as non-trusted at the remote Distributor, so a password is required.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;If you have downloaded and installed SQL Server 2000 Books Online (Updated - SP3), this information is available when you click the <B>Help</B> button for the new page.</P><!--/NOTE--></P>

<H3><A NAME="_changes_to_windows_synchronization_manag_d3jb"></A>5.3.16 Changes to Windows Synchronization Manager Support</H3>

<P><I>Introduced in SP3</I></P>

<P>SQL Server allows you to enable existing subscriptions (created using SQL Server Enterprise Manager, SQL-DMO, and replication stored procedures) for use with Windows Synchronization Manager. You can also create new subscriptions using Windows Synchronization Manager. After you apply the service pack, when synchronizing a subscription, Windows Synchronization Manager will prompt you to enter the password or passwords required to connect to the servers involved in the synchronization.</P>

<H3><A NAME="_change_to_requirements_for_attaching_40o_wluf"></A>5.3.17 Change to Requirements for Attaching or Restoring a Replication Database</H3>

<P><I>Introduced in SP3</I></P>

<P>After SP3 has been applied, when a user attaches or restores a database that has been published for replication, the user must be a member of the <B>sysadmin</B> fixed server role and cross-database chaining must be enabled. If these conditions are not met, you can execute the <B>sp_changedbowner</B> stored procedure on the database to assign database ownership to the <B>sa</B> built-in administrator login. This ensures that replication functions correctly.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;You must be a member of the sysadmin fixed server role to execute<B> sp_changedbowner </B>. </P><!--/NOTE--></P>

<P>For more information about cross-database ownership chaining, see Section 5.1.11 <A HREF="#_enabling_cross45database_ownership_chain_ar5q">Cross-Database Ownership Chaining</A>.</P>

<H2><A NAME="_5464_sql_server_agent_enhancements_705"></A>5.4 SQL Server Agent Enhancements</H2>

<P>This section discusses enhancements to SQL Server Agent that are included in SP3. </P>

<H3><A NAME="_sql_server_agent_logs_account_information"></A>5.4.1 SQL Server Agent Logs Account Information</H3>

<P><I>Introduced in SP2</I></P>

<P>The SQL Server Agent Job History now records the Windows account under which each job step runs. This information helps administrators diagnose security issues with scheduled jobs, including scheduled jobs that are defined for replication and Data Transformation Services (DTS) tasks.</P>

<H3><A NAME="_5464461_changes_to_master47target_server_533"></A>5.4.2 Changes to Master/Target Server Configurations</H3>

<P><I>Introduced in SP3</I></P>

<P>Multiserver administration is the process of automating administration tasks across multiple instances of SQL Server. Use multiserver administration if you manage two or more servers and you want to centralize maintenance tasks.</P>

<P>In SP3, the SQL Server Agent service account does not have to be a Windows administrator unless you need to use the SQL Server Agent Proxy Account. For more information about the SQL Server Agent Proxy Account, see Section 5.7.3 <A HREF="#_sql_server_agent_proxy_account_improvements">SQL Server Agent Proxy Account Improvements</A>. The SQL Server Agent service account must be a member of the <B>sysadmin</B> fixed server role.</P>

<P>With multiserver administration, you must have at least one master server and at least one target server. A master server distributes jobs to and receives events from target servers. A master server stores the central copy of job definitions for jobs that run on target servers. Target servers connect periodically to their master server to update their list of jobs to perform. If a new job exists, the target server downloads the job and disconnects from the master server. After the target server completes the job, it reconnects to the master server and reports the status of the job.</P>

<P>Before you apply SP3, you must complete several steps to upgrade your SQL Server 2000 master/target server configuration. The changes that are introduced with SP3 are not compatible with SQL Server 7.0 target servers, or with any servers not running SP3. This is a change from the original SQL Server 2000 functionality. </P>

<P class=label><B>To upgrade your master/target server configuration</B>

<OL>
	<LI>Create a new MSX (master server) account on your master server. This is to prepare TSX (target server) server (or servers) for the upgrade. To do this, run the following commands. 
<PRE><CODE>--Option A: Windows authentication
EXEC sp_grantlogin 'DOMAIN\user'
GO
USE msdb
GO
EXEC sp_adduser 'DOMAIN\user', 'DOMAIN\user', 'TargetServersRole'
GO

--Option B: SQL Server authentication &#0150; see explanation below for 
--details.
EXEC sp_addlogin &lt;MSXAccount&gt;, &lt;MSXAccountPassword&gt;, 'msdb' 
GO
USE msdb
GO
EXEC sp_adduser &lt;MSXAccount&gt;, &lt;MSXAccount&gt;, 'TargetServersRole'
GO</CODE></PRE>

<P class=tl>Where &lt;MSXAccount&gt; represents the SQL Login name you choose and &lt;MSXAccountPassword&gt; represents the associated password. </P>
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;These values must be enclosed in single quotation marks.</P><!--/NOTE--></p></LI>
</OL>

<P>You have the following options when choosing an MSX account:

<UL type=disc>
	<LI>Windows Authentication. This is the most secure option, because passwords do not have to be stored, and SQL Server and SQL Server Agent can be configured without local Windows administrator rights.<BR><BR></LI>

	<LI>SQL Server Authentication. This requires the SQL Server Agent service accounts to have local Window administrator rights because SQL Server stores the user name and password as a local security authority (LSA) secret, and access is restricted to local Windows administrators. You can create an account for all TSX servers, or you can create one account for each TSX server.</LI>
</UL>

<P>Do not specify a SQL Server Agent probe account (&lt;computer_name&gt;_msx_probe_login). As part of the upgrade to SP3, SQL Server removes the old probe accounts because the TSX servers no longer use them.

<OL start=2>
	<LI>Upgrade your TSX servers to SP3 one at a time. (Before you apply the service pack, see Step 3 for more information about timing your upgrade.) <BR><BR></LI>

	<LI>To minimize down time, run the extended stored procedure <B>xp_sqlagent_msx_account</B> on each TSX server shortly after the SP3 update is complete. 
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;After running <B>xp_sqlagent_msx_account</B>, SQL Agent must be stopped and restarted on each server.</P><!--/NOTE--></p>
<P class=tl>For more information about <B>xp_sqlagent_msx_account</B>, see Section 5.4.3 <A HREF="#_5464462_new_sql_server_agent_extended_st_579">New SQL Server Agent Extended Stored Procedure</A>. </P></LI>

	<LI>Apply SP3 to your master server. The old _msx_probe accounts are removed by SP3 Setup, because the TSX servers no longer use them. If an account owns SQL Agent jobs, the account is not removed, and you must change the owner of the jobs to another user and manually remove these accounts. If you want to continue to use the old _msx_probe accounts that own SQL Agent jobs, you may have to change the password of the _msx_probe account.</LI>
</OL>

<H3><A NAME="_5464462_new_sql_server_agent_extended_st_579"></A>5.4.3 New SQL Server Agent Extended Stored Procedure</H3>

<P><I>Introduced in SP3</I></P>

<P>SP3 includes a new extended stored procedure that allows you to configure the account that the SQL Server Agent TSX server uses to download instructions from an MSX server. This account is also known as the MSX account, or master server account.</P>

<H5>xp_sqlagent_msx_account</H5>

<P>The <B>xp_sqlagent_msx_account</B> extended stored procedure sets or retrieves the SQL Server Agent MSX account user name and password to or from the LSA secrets on the TSX server. Only members of the <B>securityadmin</B> fixed server role can run this extended stored procedure. </P>

<P>Before you can execute this extended stored procedure, SQL Server Agent must be running. In addition, if the account specified is a SQL Server login, SQL Server Agent must have local Windows administrator rights. SQL Server Agent stores the user name and password as an LSA secret, and access is restricted to local Windows administrators.</P>

<H5>Syntax</H5>

<P><B>xp_sqlagent_msx_account</B></P>

<P><B>&nbsp;&nbsp;&nbsp;&nbsp;{N'GET' |</B></P>

<P><B>&nbsp;&nbsp;&nbsp;&nbsp;N'SET' | N'DEL',</B> <B>N'</B>MSX_<I>domain_name</I><B>'</B>,<I> </I><B>N'</B>MSX_<I>username</I><B>'</B>,<I> </I><B>N'</B>MSX_<I>password</I><B>'</B></P>

<P><I>&nbsp;&nbsp;&nbsp;&nbsp;</I><B>}</B></P>

<H5>Arguments</H5>

<P class=dt><B>N'GET' </B></P>

<P class=indent>Retrieves the current SQL Server Agent MSX account. <B>N'GET'</B> is an <B>nvarchar </B>with no default. The password is not reported for security reasons.</P>

<P class=dt><B>N'SET'</B></P>

<P class=indent>Sets the account to be used as the SQL Server Agent MSX account. Use the <I>MSX_username</I>, and <I>MSX_password</I> parameters to specify the account to use as the SQL Server Agent MSX account. <B>N'SET'</B> is an <B>nvarchar</B> with no default.</P>

<P class=dt><B>N'DEL'</B></P>

<P class=indent>Deletes the SQL Server Agent MSX account. </P>

<P class=dt><I>'MSX_domain_name'</I></P>

<P class=indent>Reserved for future use.</P>

<P class=dt><I>'MSX_username'</I></P>

<P class=indent>The name of the Windows account to be used as the SQL Server Agent MSX account. Specify an empty string for this parameter and <I>MSX_password</I> to select Windows security. In this case, the SQL Server Agent service account credentials are used to log on to the MSX server. <I>MSX_username</I> is an <B>nvarchar</B> with no default.</P>

<P class=dt><I>'MSX_password'</I></P>

<P class=indent>The password for the SQL Server account specified in <I>MSX_username</I>. Specify an empty string for this parameter and the <I>MSX_username</I> to select Windows security. In this case, the SQL Server Agent service account credentials are used to log in to the MSX server. <I>MSX_password</I> is an <B>nvarchar</B> with no default.</P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;Parameters for <B>xp_sqlagent_msx_account</B> must be specified in order. Named parameters cannot be used.</P><!--/NOTE--></P>

<H5>Return Code Values</H5>

<P>Returns a value of <B>0</B> on success or <B>1</B> on failure.</P>

<P>When <B>xp_sqlagent_msx_account</B> fails and returns a value of <B>1</B>, SQL Server generates an error message with information about the error.</P>

<H5>Result Sets</H5>

<P>If a SQL Server Agent MSX account has been set, <B>xp_sqlagent_msx_account</B> returns a result set with the following information when you specify <B>N'GET'</B>.</P>

<TABLE border=1 cellpadding=2 cols=3 frame=box rules=rows width=582>

<TR VALIGN="top">
<TH class=label width=25%>Column</TH>
<TH class=label width=24%>Data type</TH>
<TH class=label width=51%>Description</TH>
</TR>

<TR VALIGN="top">
<TD width=25%>domain</TD>
<TD width=24%><B>sysname</B></TD>
<TD width=51%>N/A. Reserved for future use.</TD>
</TR>

<TR VALIGN="top">
<TD width=25%>username</TD>
<TD width=24%><B>sysname</B></TD>
<TD width=51%>Account used as the SQL Server Agent MSX account.</TD>
</TR>
</TABLE><BR>

<P>If a SQL Server Agent MSX account has not been set, or if <B>N'SET'</B> is specified, no result set is returned.</P>

<H5>Permissions</H5>

<P>Execute permissions for <B>xp_sqlagent_msx_account</B> default to members of the <B>securityadmin</B> fixed server role.</P>

<H5>Examples</H5>

<OL type=A>
	<LI><B>Retrieve the currently assigned SQL Server Agent MSX account </B></LI>
</OL>

<P>The following example retrieves the account currently assigned for use as the SQL Server Agent MSX account:</P>

<PRE><CODE>EXEC master.dbo.xp_sqlagent_msx_account N'GET'</CODE></PRE>

<OL start=2 type=A>
	<LI><B>Set the SQL Server Agent MSX Account to use Windows Authentication</B></LI>
</OL>

<P>The following example sets the SQL Server Agent MSX account to use Windows Authentication:</P>

<PRE><CODE>EXEC master.dbo.xp_sqlagent_msx_account N'SET',
   N'',  -- Reserved for future use 
   N'',  -- MSX_username
   N''  -- MSX_password</CODE></PRE>

<H6>C. Set the SQL Server Agent MSX account to SQL Server Authentication</H6>

<P>The following example sets the SQL Server Agent MSX account to Ralph and specifies a password:</P>

<PRE><CODE>EXEC master.dbo.xp_sqlagent_msx_account N'SET',
   N'',  -- Reserved for future use 
   N'Ralph',  -- MSX_username
   N'RalphPwd'  -- MSX_password</CODE></PRE>

<H6>D. Delete the SQL Server Agent MSX account</H6>

<P>The following example deletes the SQL Server Agent MSX account. This means that SQL Server Agent defaults to Windows integrated security authentication.</P>

<PRE><CODE>EXEC master.dbo.xp_sqlagent_msx_account N'DEL'</CODE></PRE>

<H3><A NAME="_sql_server_agent_permission_checks_d3jb"></A>5.4.4 SQL Server Agent Permission Checks</H3>

<P><I>Introduced in SP3</I></P>

<P>SQL Server now checks to ensure that the Agent job owner has permission to append or overwrite the output log file from each job. This happens in three ways:

<UL type=disc>
	<LI>If the job owner is a member of the <B>sysadmin</B> fixed server role, the job output log file can be written to the server. <BR><BR></LI>

	<LI>If the job owner is a Windows user, SQL Server tests to see if the user has permission to write to the selected job output log file location on the server.<BR><BR></LI>

	<LI>If the job owner is a SQL Server user, SQL Server tests the SQL Server Agent proxy account for permission to write to the selected job output log file location on the server. If the proxy account has not been set, no log is written. </LI>
</UL>

<P>In all cases, jobs are written with SQL Server Agent credentials, but SQL Server now tests to ensure the user has permission to write to the selected job output log file location on the server. Errors appear in the job history, but the job steps do not fail if the log file cannot be written.</P>

<H2><A NAME="_sql_server_connectivity_components_aks2"></A>5.5 SQL Server Connectivity Components Enhancements</H2>

<P>This section discusses enhancements to connectivity components of SQL Sever 2000 that are included with SP3.</P>

<H3><A NAME="_microsoft_data_access_components_9s7l"></A>5.5.1 Updates to Microsoft Data Access Components</H3>

<P><I>Introduced in SP3</I></P>

<P>SP3 includes updates to the Microsoft Data Access Components (MDAC). When you install SP3, MDAC 2.7 Service Pack 1 is also installed. MDAC 2.7 SP1 has no feature changes from the version of MDAC installed by SQL Server 2000 (MDAC 2.6), but it does include fixes and security enhancements. MDAC 2.71 includes an upgrade to MSXML 3 SP3.</P>

<P><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;This version of MDAC is not installed if Setup detects the same version or a newer version.</P><!--/NOTE--></P>

<P>For more information about this version of MDAC, see the Microsoft Universal Data Access Web site at this page on <A HREF="http://go.microsoft.com/fwlink/?LinkId=9371" target=_blank>microsoft.com</A>. Fixes included in this version of MDAC will be documented in Knowledge Base article <A HREF="http://go.microsoft.com/fwlink/?LinkId=11610" target=_blank>326848</A>. You can access this article from the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>.</P>

<H3><A NAME="_support_for_qlogic_virtual_interface_arc_wrr2"></A>5.5.2 Support for QLogic Virtual Interface Architecture</H3>

<P><I>Introduced in SP3</I></P>

<P>SQL Server now supports QLogic Virtual Interface Architecture (VIA) System Area Network (SAN) implementations. To enable SQL Server support for connections over QLogic VIA, both the client and server computers must provide IP address resolution in a file named Vihosts in the appropriate Windows system32\drivers\etc folder.</P>

<P>The Vihosts file should be formatted as follows:</P>

<P>&lt;VI IP Address of server computer&gt; &lt;SERVER_COMPUTERNAME&gt;</P>

<P>&lt;VI IP Address of client computer&gt; &lt;CLIENT_COMPUTERNAME&gt;</P>

<P>For example:</P>

<P>139.4.130.1&nbsp; SQLCOMPUTER</P>

<P>139.4.130.2&nbsp; SQLCLIENT</P>

<P>Use IP addresses from the respective QLogic VIA network cards and actual computer names. Otherwise, connections cannot be made to named instances or with other IP protocols such as TCP or Named Pipes. The Vihosts file is not necessary for Giganet VIA connectivity. </P>

<P class=indent><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;You must identify the correct VIA vendor on client computers by using Client Network Utility. Select the appropriate value in the <B>Vendor</B> drop-down box. The corresponding action should also be completed on server computers through Server Network Utility.</P><!--/NOTE--></P>

<H2><A NAME="_meta_data_services"></A>5.6 Meta Data Services Enhancements</H2>

<P>This section discusses enhancements to SQL Server 2000 Meta Data Services that are included with SP3.</P>

<H3><A NAME="_meta_data_browser_exports_in_unicode"></A>5.6.1 Meta Data Browser Exports in Unicode</H3>

<P><I>Introduced in SP1</I></P>

<P>Meta Data Browser now exports XML-based meta data in Unicode. Before SQL Server 2000 SP1, the browser exported ANSI code, which does not support non-English characters. This functional change is invisible to the user. As of this SP3 release, exported data is always expressed as Unicode. You can still export in ANSI code by setting the value of the registry key <B>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Repository\Engine\XMLExport</B> to 0. The following list represents the values that you can set for this registry key:

<UL type=disc>
	<LI>NOOBJID=1<BR><BR></LI>

	<LI>NOHEADER=2<BR><BR></LI>

	<LI>INDENTATION=4<BR><BR></LI>

	<LI>UNICODE=8<BR><BR></LI>

	<LI>LOGUNMAPPEDTAGS=16<BR><BR></LI>

	<LI>EXPORTBASE=32</LI>
</UL>

<P>For more information about each flag, see "IExport::Export Method" in SQL Server Books Online.</P>

<H3><A NAME="_scripting_support_disabled_fzpy"></A>5.6.2 Scripting Support Disabled</H3>

<P><I>Introduced in SP3</I></P>

<P>Script support in information models has been disabled. After installing SP3, you receive the following error if your application accesses a property or method for which a script is defined: </P>

<PRE><CODE>EREP_SCRIPTS_NOTENABLED</CODE></PRE>

<P class=label><B>To enable script support</B></P>

<P>If you need to continue executing scripts, you can use the following procedure to create a registry setting that enables script support. 

<OL>
	<LI>Open Registry Editor and navigate to <B>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft</B>. <BR><BR></LI>

	<LI>Create a registry key named <B>Repository</B> (if one does not already exist), and then create a sub-key named <B>Engine</B> so that the path equals <B>Repository\Engine</B>. <BR><BR></LI>

	<LI>On the <B>Engine</B> registry key, add a new DWORD value named <B>AllowScripting</B> and set the value to <B>1</B>. </LI>
</OL>

<P>If you want to disable scripting later, set the value of this new registry key to <B>0</B>.</P>

<P class=indent><!--IMPORTANT--><P ID="Alert_Important"><B CLASS="notes">Important</B>&nbsp;&nbsp;You should always secure information models and the repository database to prevent unauthorized access.</P><!--/IMPORTANT--></P>

<H3><A NAME="_new_repositoryuser_role_needed_to_access_d3jb"></A>5.6.3 New RepositoryUser Role for Accessing Repository Information</H3>

<P><I>Introduced in SP3</I></P>

<P>SQL Server includes in the <B>msdb</B> database a set of tables, stored procedures, and views that store information used by the Meta Data Services repository engine. In SP3, a new dedicated role named <B>RepositoryUser</B> has been added and must be used to access and update repository information. This role has been granted create, read, update, delete, and execute permissions on these objects. The <B>public</B> role no longer has permissions on these objects. </P>

<P>This change affects existing repository objects in addition to any additional objects created by the repository engine in the future. Users and applications that access the repository through the <B>public</B> role must be added to the <B>RepositoryUser </B>role.</P>

<H2><A NAME="_data_transformation_services"></A>5.7 Data Transformation Services Enhancements</H2>

<P>This section discusses enhancements to SQL Server 2000 Data Transformation Services that are included with SP3.</P>

<H3><A NAME="_dts_wizard_no_longer_limits_string_columns_to_255_characters"></A>5.7.1 DTS Wizard No Longer Limits String Columns to 255 Characters</H3>

<P><I>Introduced in SP2</I></P>

<P>When you export data to a text file, the DTS Import/Export Wizard now configures the package to write up to 8000 characters of any column containing string-type data.</P>

<H3><A NAME="_security_context_logged_for_dts_packages_run_by_sql_server_agent"></A>5.7.2 Security Context Logged for DTS Packages Run by SQL Server Agent</H3>

<P><I>Introduced in SP2</I></P>

<P>SQL Server Agent records the security context under which each step in a job runs. Beginning with SP3, the security context appears in the Job History dialog box. When you run a DTS package from a step in a job, the SQL Server Agent logs the user account under which the package runs. This information helps administrators diagnose permission and authentication issues that occur when DTS packages are scheduled to run on a server.</P>

<H3><A NAME="_sql_server_agent_proxy_account_improvements"></A>5.7.3 SQL Server Agent Proxy Account Improvements</H3>

<P><I>Introduced in SP2</I></P>

<P>Prior to SP3, DTS packages stored on the server could not be run under the credentials of the SQL Server Agent Proxy Account unless the proxy account had access to the user Temp folder for the account under which either the server (in the case of jobs run from <B>xp_cmdshell</B>), or the agent (in the case of agent jobs) was running. Because of this, users often had to adjust the TEMP environment variable for the SQL Server or SQL Agent startup account to point to a directory that was accessible to both the startup and the proxy accounts, such as C:\Temp. For SP3, DTS has been enhanced to use the system Temp folder if the user Temp folder is unavailable, greatly reducing the need for these adjustments.</P>

<H3><A NAME="_save_to_repository_disabled_by_default_d3jb"></A>5.7.4 Save to Meta Data Services Disabled by Default</H3>

<P><I>Introduced in SP3</I></P>

<P>By default, SP3 disables the option to store DTS packages in Meta Data Services. This means that the <B>Meta Data Services</B> option does not appear in the <B>Location</B> drop-down list in the <B>Save DTS Packages</B> dialog box. In addition, this option is disabled on the Save, schedule, and replicate package page in the DTS Import/Export Wizard. </P>

<P class=label><B>To allow packages to be saved in Meta Data Services</B>

<UL type=disc>
	<LI>In SQL Server Enterprise Manager, right-click the <B>Data Transformation Services</B> node, click <B>Properties</B>, and then click <B>Enable to Meta Data Services</B>. 
<P class=atl><!--NOTE--><P ID="Alert_Note"><B>Note</B>&nbsp;&nbsp;You must be logged on with administrator privileges to modify this property.</P><!--/NOTE--></p></LI>
</UL>

<P>When the option to store packages in Meta Data Service is disabled, you can load existing packages from Meta Data Services, edit them, and save them to Meta Data Services using the <B>Save</B> option. However, Meta Data Services is not available from the <B>Save As</B> option. For example, you cannot re-save a package to Meta Data Services using a different name.</P>

<H2><A NAME="_sqlxml_enhancement_d3jb"></A>5.8 XML Enhancements</H2>

<P>The following topic discusses an enhancement for XML and SQLXML in SP3.</P>

<H3><A NAME="_improved_validation_of_xpath_expressions_wluf"></A>5.8.1 Improved Validation of XPath Expressions</H3>

<P><I>Introduced in SP3</I></P>

<P>Prior to SP3, the version of MSXML that was installed with SQL Server 2000 (MSXML 2.6) permitted a predicate in an XPath expression to follow the special character abbreviation that identifies the current context node, which is denoted by a period (<CODE>.</CODE>) in XPath syntax. This violates the XPath syntax specification, which requires that this character be followed by a location path expression. </P>

<P>When you apply SP3, an updated version of MSXML (3.0 SP3) is installed as part of the MDAC upgrade. For more information, see Section 5.5.1 <A HREF="#_microsoft_data_access_components_9s7l">Updates to Microsoft Data Access Components</A>. </P>

<P>With the new version of MSXML, a predicate cannot immediately follow the current context node abbreviation special character. XPath expressions in SQLXML queries (XPath queries against annotated mapping schemas and in XSLT style sheets written to transform the results of SQLXML queries) that use the faulty syntax will fail after you upgrade to SP3.</P>

<P>To prevent these failures, identify and fix any expressions that use the incorrect syntax. For example, the syntax of the XPath expression that is specified as the value of the test attribute in the following <CODE>xsl:if</CODE> element is not valid because the predicate, <CODE>[@ResourceTypeID='2']</CODE>, immediately follows the special character abbreviation that identifies the current context node. </P>

<P>The following statement, which previously did not generate an error, will fail after SP3 is installed. </P>

<PRE><CODE>&lt;xsl:if test=".[@ResourceTypeID='2']"&gt;</CODE></PRE>

<P>To prevent a failure, the XPath expression must be amended as follows:</P>

<PRE><CODE>&lt;xsl:if test="@ResourceTypeID='2'"&gt;</CODE></PRE>

<H2><A NAME="_enhancements_to_the_virtual_backup_device_api"></A>5.9 Virtual Backup Device API Enhancements</H2>

<P>The following item applies to the SQL Server 2000 Virtual Backup Device API.</P>

<H3><A NAME="_capturing_multiple_databases_in_a_single_snapshot"></A>5.9.1 Capturing Multiple Databases in a Single Snapshot</H3>

<P><I>Introduced in SP2</I></P>

<P>The Virtual Backup Device API allows ISVs to integrate SQL Server 2000 into their products. This API is engineered to provide maximum reliability and performance. It fully supports the backup and restore functionality of SQL Server 2000, including the complete range of hot and snapshot backup capabilities.</P>

<P>In SP1 and earlier, there was no way to freeze and back up more than a single database at one time. SP3 now provides server-side support for freezing and capturing multiple databases in a single snapshot through the <B>VDC_PrepareToFreeze</B> command.</P>

<P>The Virtual Backup Device Specification in SP3 contains updated information about the <B>VDC_PrepareTo Freeze</B> command. An updated version of the Virtual Device Interface header file (Vdi.h) can be found at \Devtools\Include in the SP3 setup directory. </P>

<P>You can download the updated specification from the Microsoft Download center at the <A HREF="http://go.microsoft.com/fwlink/?LinkId=4172" target=_blank>Microsoft SQL Server Downloads Web site</A>.</P>

<H2><A NAME="_5467_error_reporting_705"></A>5.10 Error Reporting</H2>

<P><I>Introduced in SP3</I></P>

<P>Microsoft SQL Server error reporting is disabled by default. You can enable it during installation through SQL Server Setup or Analysis Services Setup, or after installation through the <B>Server Properties</B> dialog box in Enterprise Manager or the <B>Server</B> <B>Properties</B> dialog box in Analysis Manager. Enabling error reporting while you are running SQL Server Setup allows error reporting for the SQL Server database engine and SQL Server Agent. Enabling error reporting while you are running Analysis Services Setup allows error reporting for Analysis Services. If you want to enable error reporting for both SQL Server and Analysis Services, you must enable error reporting for SQL Server while running SQL Server Setup and Analysis Services while running Analysis Services Setup. </P>

<P>If you enable this feature, SQL Server is configured to send a report to Microsoft automatically if a fatal error occurs in the SQL Server database engine, in SQL Server Agent, or in SQL Server Analysis Services. Microsoft uses error reports to improve SQL Server functionality and treats all information as confidential. </P>

<P>Information about errors is sent over a secure (HTTPS) connection to Microsoft, where it is stored with limited access. Alternatively, this information can be sent to your own Corporate Error Reporting server. See this <A HREF="http://go.microsoft.com/fwlink/?LinkId=9309" target=_blank>Microsoft Web site</A> for more information about setting up a Corporate Error Reporting server.</P>

<P>The error report contains the following information:

<UL type=disc>
	<LI>The condition of SQL Server when the problem occurred.<BR><BR></LI>

	<LI>The operating system version and computer hardware information.<BR><BR></LI>

	<LI>Your digital Product ID, which can be used to identify your license.<BR><BR></LI>

	<LI>The network IP address of your computer.<BR><BR></LI>

	<LI>Information from memory or files of the process that caused the error.</LI>
</UL>

<P>Microsoft does not intentionally collect your files, name, address, e-mail address, or any other form of personal information. The error report can, however, contain customer-specific information from the memory or files of the process that caused the error. Although this information can potentially be used to determine your identity, Microsoft does not use this information for that purpose.</P>

<P>For the Microsoft error reporting data collection policy, see this <A HREF="http://go.microsoft.com/fwlink/?LinkId=9310" target=_blank>Microsoft Web site</A>.</P>

<P>If you enable error reporting and a fatal error occurs, you may see a response from Microsoft in the Windows Event log that points to a Microsoft Knowledge Base article about a particular error. A response may look similar to the following example:</P>

<PRE><CODE>Source = MSSQLServerOlapServicesDW 
EventID = 1010
data = http://support.microsoft.com/support/misc/kblookup.asp?id=Q123456&amp;iBucketTable=1&amp;iBucket=39980&amp;Cab=21474432.cab&amp;LCID=1033&amp;OS=5.1.2600.2.00010100.0.0</CODE></PRE>

<P>To disable error reporting for the SQL Server database engine and SQL Server Agent, go to SQL Server Properties (General Tab) in Enterprise Manager and clear the <B>Enable the error reporting</B> check box. To disable error reporting for Analysis Services, go to Server Properties in Analysis Manager and clear the <B>Enable Error Reporting</B> check box. If error reporting is enabled for both SQL Server (database engine and SQL Server Agent) and Analysis Services, you must disable error reporting for SQL Server and Analysis Services individually. </P>

<H2><A NAME="_english_query_enhancement"></A>5.11 English Query Enhancements</H2>

<P><I>Introduced in SP1</I></P>

<P>Microsoft has released a security enhancement for English Query applications. This enhancement is not installed as a part of the service pack. However, it is recommended that you apply it if you use English Query. The security enhancement is located on the SP3 CD-ROM in the folder \EQHotfix. Details about the English Query enhancement are available at the <A HREF="http://go.microsoft.com/fwlink/?LinkId=3930" target=_blank>Microsoft Product Support Services Knowledge Base</A>. Search the Knowledge Base for article <A HREF="http://go.microsoft.com/fwlink/?LinkId=9134" target=_blank>297105</A>.</P>

<H2><A NAME="_db-library_and_embedded_sql_for_c"></A>5.12 DB-Library and Embedded SQL for C</H2>

<P><I>Introduced in SP1</I></P>

<P>While the DB-Library and Embedded SQL for C APIs are still supported in SQL Server 2000, no future versions of SQL Server will include the files that are necessary to program applications that use these APIs. Connections from existing applications written using DB-Library and Embedded SQL for C will still be supported in the next version of SQL Server, but this support will be dropped in a future release. When writing new applications, avoid using these components. When modifying existing applications, you are strongly encouraged to remove dependencies on these technologies. Instead of DB-Library or Embedded SQL for C, you can use ADO, OLE DB, or ODBC to access data in SQL Server. For more information about these technologies, see SQL Server Books Online.</P>

</BODY>
</HTML>
